var SCREEN_XS=480;var SCREEN_SM=768;var SCREEN_MD=1100;var SCREEN_LG=1280;var SCREEN_XL=1400;
String.prototype.hashCode=function(){var hash=0,i,chr,len;if(this.length===0)return hash;for(i=0,len=this.length;i<len;i++){chr=this.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash|=0;}
return hash;};
'use strict';var nla=angular.module('ngLetterAvatar',[]);nla.constant('defaultSettings',{alphabetcolors:["#749edb","#db7474","#db9774","#dbb974","#dbdb74","#b9db74","#97db74","#74db74","#74db97","#74dbb9","#74dbdb","#74b9db","#7497db","#7474db","#9774db","#b974db","#db74db","#db74b9","#db7497","#db7474","#7488db","#dbae74","#dbd874","#999999","#666666","#333333"],textColor:'#ffffff',defaultBorder:'border:5px solid white',triangleup:'width: 0;height: 0;border-left: 50px solid transparent;border-right: 50px solid transparent;border-bottom: 100px solid;',fontsize:30,height:50,width:50,fontWeight:400,charCount:1,fontFamily:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica, Arial,Lucida Grande, sans-serif',base:'data:image/svg+xml;base64,',radius:'border-radius:50%;',custombgcolor:'',dynamic:'false',rotatedeg:'0'});nla.directive('ngLetterAvatar',['defaultSettings',function(defaultSettings){return{restrict:'AE',replace:true,scope:{alphabetcolors:'=alphabetcolors',data:'@'},link:function(scope,element,attrs){var params={charCount:attrs.charcount||defaultSettings.charCount,data:attrs.data,textColor:defaultSettings.textColor,height:attrs.height||defaultSettings.height,width:attrs.width||defaultSettings.width,fontsize:attrs.fontsize||defaultSettings.fontsize,fontWeight:attrs.fontweight||defaultSettings.fontWeight,fontFamily:attrs.fontfamily||defaultSettings.fontFamily,avatarBorderStyle:attrs.avatarcustomborder,avatardefaultBorder:attrs.avatarborder,defaultBorder:defaultSettings.defaultBorder,shape:attrs.shape,alphabetcolors:scope.alphabetcolors||defaultSettings.alphabetcolors,avatarCustomBGColor:attrs.avatarcustombgcolor||defaultSettings.custombgcolor,dynamic:attrs.dynamic||defaultSettings.dynamic,rotatedeg:attrs.rotatedeg||defaultSettings.rotatedeg};if(params.dynamic==='true'){scope.$watch('data',function(){_generateLetterAvatar();});}else{_generateLetterAvatar();}
function _generateLetterAvatar(){var c='';if(params.charCount==2){var _data=getFirstAndLastName(scope.data.toUpperCase());if(_data){c=_data;}else{c=scope.data.substr(0,params.charCount).toUpperCase();}}else{c=scope.data.substr(0,params.charCount).toUpperCase();}
var cobj=getCharacterObject(c,params.textColor,params.fontFamily,params.fontWeight,params.fontsize);var colorIndex='';var color='';if(c.charCodeAt(0)<65){color=getRandomColors();}else{colorIndex=Math.floor((c.charCodeAt(0)-65)%params.alphabetcolors.length);color=params.alphabetcolors[colorIndex];}
if(params.avatarCustomBGColor){color=params.avatarCustomBGColor;}
var svg=getImgTag(params.width,params.height,color);svg.append(cobj);var lvcomponent=angular.element('<div>').append(svg.clone()).html();var svgHtml=window.btoa(unescape(encodeURIComponent(lvcomponent)));var component;var base=defaultSettings.base;var _style='';if(params.avatarBorderStyle){_style=params.avatarBorderStyle;}else if(params.avatardefaultBorder){_style=params.defaultBorder;}
if(params.rotatedeg!='0'){_style='-ms-transform: rotate('+params.rotatedeg+'deg); -webkit-transform: rotate('+params.rotatedeg+'deg); transform: rotate('+params.rotatedeg+'deg)';}
if(params.shape){if(params.shape==='round'){var round_style=defaultSettings.radius+_style;if(scope.data.indexOf('http')>-1||scope.data.indexOf('data:image')>-1){var img_size='width:'+params.width+'px;height:'+params.height+'px;';component="<img src="+scope.data+" style='"+img_size+round_style+"'  />";}else{component="<img src="+base+svgHtml+" style='"+round_style+"' alt='"+scope.data+"' />";}}}else{if(scope.data.indexOf('http')>-1||scope.data.indexOf('data:image')>-1){var img_size='width:'+params.width+'px;height:'+params.height+'px;';component="<img src="+scope.data+" style='"+img_size+_style+"'  />";}else{component="<img src="+base+svgHtml+" style='"+_style+"' alt='"+scope.data+"' />";}}
if(params.dynamic==='true'){element.empty();element.append(component);}else{element.replaceWith(component);}}}};}]);function getRandomColors(){var letters='0123456789ABCDEF'.split('');var _color='#';for(var i=0;i<6;i++){_color+=letters[Math.floor(Math.random()*16)];}
return _color;}
function getFirstAndLastName(data){var names=data.split(" ");if(names&&names.length>=2){var firstName=names[0];var lastName=names[1];if(firstName&&lastName){var text=firstName.substr(0,1)+lastName.substr(0,1);return text;}else{return data.substr(0,2);}}}
function getImgTag(width,height,color){var svgTag=angular.element('<svg></svg>').attr({'xmlns':'http://www.w3.org/2000/svg','pointer-events':'none','width':width,'height':height}).css({'background-color':color,'width':width+'px','height':height+'px'});return svgTag;}
function getCharacterObject(character,textColor,fontFamily,fontWeight,fontsize){var textTag=angular.element('<text text-anchor="middle"></text>').attr({'y':'50%','x':'50%','dy':'0.35em','pointer-events':'auto','fill':textColor,'font-family':fontFamily}).html(character).css({'font-weight':fontWeight,'font-size':fontsize+'px',});return textTag;}
function registerCommands(cmdStr){if(typeof cmdStr!='string')return;var pM=cmdStr.split(',');var pms=new Array();var pmCount=0;pms=pms.concat(pM);for(var i=0;i<pM.length;i++){eval(pM[i].toUpperCase()+'='+pmCount++);}}
registerCommands('donothing,inarray,caparray,sticky,background,noclose,caption,left,right,center,offsetx,offsety,fgcolor,bgcolor,textcolor,capcolor,closecolor,width,border,cellpad,status,autostatus,autostatuscap,height,closetext,snapx,snapy,fixx,fixy,relx,rely,fgbackground,bgbackground,padx,pady,fullhtml,above,below,capicon,textfont,captionfont,closefont,textsize,captionsize,closesize,timeout,function,delay,hauto,vauto,closeclick,wrap,followmouse,mouseoff,closetitle,cssoff,compatmode,cssclass,fgclass,bgclass,textfontclass,captionfontclass,closefontclass');function ImageResizer(){}
angular.module('geekAdBlock',[]).constant('adBlock',GEEK.adBlock).constant('adConfig',GEEK.adConfig).constant('userid',GEEK.userid).constant('domainname',GEEK.domainname).constant('domain',GEEK.domain);angular.module('geekDfp',[]).constant('googleTargets',GEEK.googleTargets);angular.module('geekAdSlots',[]).constant('adSlots',GEEK.adSlots);GEEK.prefixedApiUrls=_.mapValues(GEEK.apiurls,function(url){return(GEEK.apiurlsPrefix||'')+url;});angular.module('geekLayout',[]).constant('legacy',GEEK.legacy);angular.module('geekApiConfig',[]).constant('geekAPIUrlsDirect',GEEK.apiurls).constant('geekAPIUrls',GEEK.prefixedApiUrls);angular.module('geekitemPreload',[]).constant('geekitemPreload',GEEK.geekitemPreload);angular.module('geekitemSettings',[]).constant('geekitemSettings',GEEK.geekitemSettings).constant('geekitemModules',GEEK.geekitemModules);angular.module('geekGlobalSettings',[]).constant('geekGlobalSettings',GEEK.geekGlobalSettings);angular.module('geekimageSettings',[]).constant('geekimageSettings',GEEK.geekimageSettings);
angular.module("ui.select").run(["$templateCache",function($templateCache){$templateCache.put("bootstrap/choices.tpl.html","<ul class=\"ui-select-choices ui-select-choices-content ui-select-dropdown dropdown-menu\" role=\"listbox\" ng-show=\"$select.open\"><li class=\"ui-select-choices-group\" id=\"ui-select-choices-{{ $select.generatedId }}\"><div class=\"divider\" ng-show=\"$select.isGrouped && $index > 0\"></div><div ng-show=\"$select.isGrouped\" class=\"ui-select-choices-group-label dropdown-header\" ng-bind=\"$group.name\"></div><div id=\"ui-select-choices-row-{{ $select.generatedId }}-{{$index}}\" class=\"ui-select-choices-row\" ng-class=\"{active: $select.isActive(this), disabled: $select.isDisabled(this)}\" role=\"option\"><a class=\"ui-select-choices-row-inner\"></a></div></li></ul>");}]);
var geekApp=angular.module('GeekApp',['ngAnimate','ngTouch','ngCookies','ui.bootstrap','ui.select','ngSanitize','cgBusy','duScroll','googlechart','angularFileUpload','ui.router','ui.router.tabs','xeditable','cgNotify','cgPrompt','ngResource','truncate','ui.scrollpoint','clickOut','ngStorage','checklist-model','ngLetterAvatar','ngDfp','geekDfp','geekAdBlock','monospaced.elastic','geekApiConfig','angularLazyImg','geekitemPreload','geekitemSettings','geekGlobalSettings','geekimageSettings','frapontillo.bootstrap-switch','timer','ngYoutubeEmbed','rzModule','ngCsv','geekAdSlots','geekLayout']).config(['$compileProvider',function($compileProvider){}]).config(['$locationProvider','$anchorScrollProvider',function($locationProvider,$anchorScrollProvider){$anchorScrollProvider.disableAutoScrolling();$locationProvider.html5Mode({enabled:true,rewriteLinks:false});}]).config(['$httpProvider',function($httpProvider){$httpProvider.useApplyAsync(true);}]).config(['DoubleClickProvider','googleTargets','adConfig','adSlots',function(DoubleClickProvider,googleTargets,adConfig,adSlots){var configAdsense=function(){var scrollbarOffset=window.innerWidth-document.documentElement.clientWidth;var adjustWidth=function(width){return Math.max(0,width-scrollbarOffset);};var adjustWidthMobile=function(width){if(screen&&screen.width&&screen.width<800&&screen.width<window.innerWidth){width=width*screen.width / window.innerWidth;}
return adjustWidth(width);};if(adConfig.noadsense){DoubleClickProvider.setEnabled(false);return;}
DoubleClickProvider.defineSlot('/1005854/ca-pub-7206761047394129/'+adSlots['dfp-leaderboard'].name,[[728,90],[320,50]],'dfp-leaderboard').defineSlot('/1005854/ca-pub-7206761047394129/'+adSlots['dfp-leaderboard-lg'].name,[1200,125],'dfp-leaderboard-lg').defineSlot('/1005854/ca-pub-7206761047394129/'+adSlots['dfp-home-sidekick'].name,[300,250],'dfp-home-sidekick').defineSlot('/1005854/ca-pub-7206761047394129/'+adSlots['dfp-medrect'].name,[300,250],'dfp-medrect').defineSlot('/1005854/ca-pub-7206761047394129/'+adSlots['dfp-skyscraper'].name,[160,600],'dfp-skyscraper').defineSlot('/1005854/ca-pub-7206761047394129/'+adSlots['dfp-medrect-reserved-home'].name,[300,250],'dfp-medrect-reserved-home').collapseEmptyDivs(true);DoubleClickProvider.defineSizeMapping('dfp-leaderboard-lg').addSize([adjustWidthMobile(1230),400],[1200,125]).addSize([adjustWidthMobile(768),400],[728,125]).addSize([adjustWidthMobile(320),400],[320,125]).addSize([0,0],[]);DoubleClickProvider.defineSizeMapping('dfp-leaderboard').addSize([adjustWidthMobile(768),200],[728,90]).addSize([adjustWidthMobile(320),400],[[320,50],[300,50]]).addSize([0,0],[]);DoubleClickProvider.defineSizeMapping('dfp-medrect').addSize([0,0],[300,250]);DoubleClickProvider.defineSizeMapping('dfp-home-sidekick').addSize([0,0],[300,250]);DoubleClickProvider.defineSizeMapping('dfp-medrect-reserved-home').addSize([adjustWidth(1100),200],[]).addSize([0,0],[300,250]);DoubleClickProvider.defineSizeMapping('dfp-skyscraper').addSize([adjustWidth(1100),200],[160,600]).addSize([0,0],[]);angular.forEach(googleTargets,function(value,key){DoubleClickProvider.setPageTargeting(key,value);});};window.addEventListener('DOMContentLoaded',configAdsense);}]).config(['userid','$localStorageProvider',function(userid,$localStorageProvider){$localStorageProvider.setKeyPrefix('user_'+userid+'_');}]);geekApp.run(['editableOptions','editableThemes','$rootScope','geekScroller','$timeout','$window','notify','loadingTracker','$location','DoubleClick','$transitions','$state','legacy',function(editableOptions,editableThemes,$rootScope,geekScroller,$timeout,$window,notify,loadingTracker,$location,DoubleClick,$transitions,$state,legacy){editableOptions.theme='bs3';editableThemes.bs3.inputClass='input-sm';editableThemes.bs3.buttonsClass='btn-sm';editableThemes.bs3.submitTpl='<button type="submit" class="btn btn-success"><span></span></button>';editableThemes.bs3.cancelTpl='<button type="button" class="btn btn-danger" ng-click="$form.$cancel()"><span></span></button>';notify.config({});var adsThrottled=true;var resetAdThrottleTimeout=function(){adsThrottled=true;$timeout(function(){adsThrottled=false;},5000);};resetAdThrottleTimeout();loadingTracker.onLoad(function(){var hash=$location.hash();if(hash){geekScroller.scrollToTargetByName(hash);}});this.stateChangeSuccess=function($transition){if($window.ga){$window.ga('send','pageview',{page:$location.path()});}
if($transition.from().name===""){return;}
if(!adsThrottled){resetAdThrottleTimeout();DoubleClick.refreshAds('dfp-skyscraper');if($window.scrollY<50)
DoubleClick.refreshAds('dfp-leaderboard');}
$timeout(function(){var eventlist="mousewheel touchmove keydown";if($window.innerWidth>=SCREEN_SM)
eventlist+=" scroll mousedown";var canceller=loadingTracker.onLoad(function(){angular.element($window).off(eventlist,canceller);var params=$transition.params();if(params['#']){geekScroller.scrollToTargetByName(params['#']);}
else{if($window.innerWidth<SCREEN_SM){geekScroller.scrollToTop();}else if($transition.from().url!=='^'){geekScroller.scrollIntoViewByName('tab');}}});angular.element($window).one(eventlist,canceller);},100);};$transitions.onSuccess({},this.stateChangeSuccess);$window.onresize=function(){$rootScope.$broadcast('scrollpointShouldReset');};}]);geekApp.factory('geekHeaders',['$window',function($window){var geekHeaders={};geekHeaders.getHeight=function(){var globalheader=document.getElementById('global-header-outer');return globalheader.clientHeight;};return geekHeaders;}]);geekApp.factory('geekScroller',['$document','$q','loadingTracker','$timeout','$window','geekHeaders',function($document,$q,loadingTracker,$timeout,$window,geekHeaders){var scroller={};var isElementInViewport=function(el){var rect=angular.element(el)[0].getBoundingClientRect();return(rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth));};var getFirstElementByName=function(name){var els=document.getElementsByName(name);return angular.element(els[0]);};var onResizeStop=function(){return $q(function(resolve){var bodyHeight=$document[0].body.clientHeight;var waitForStopResizing=function(){var newHeight=$document[0].body.clientHeight;if(newHeight===bodyHeight)
resolve();else{bodyHeight=newHeight;$timeout(waitForStopResizing,50);}};$timeout(waitForStopResizing,250);});};scroller.scrollToTarget=function(target){var canceller=loadingTracker.onLoad(function(){onResizeStop().then(function(){angular.element($window).off('scroll mousedown mousewheel touchmove keydown',canceller);if(target){var offset=geekHeaders.getHeight();$document.duScrollToElementAnimated(target,offset,500);}});});angular.element($window).one('scroll mousedown mousewheel touchmove keydown',canceller);};scroller.scrollIntoView=function(target){if(target&&!isElementInViewport(target))
scroller.scrollToTarget(target);};scroller.scrollToTop=function(){return $document.duScrollTopAnimated(0);};scroller.scrollToTargetByName=function(name){var canceller=loadingTracker.onLoad(function(){angular.element($window).off('scroll mousedown mousewheel touchmove keydown',canceller);scroller.scrollToTarget(getFirstElementByName(name));});angular.element($window).one('scroll mousedown mousewheel touchmove keydown',canceller);};scroller.scrollIntoViewByName=function(name){var el=getFirstElementByName(name);scroller.scrollIntoView(el);};return scroller;}]);geekApp.factory('loadingTracker',['$q','$timeout',function($q,$timeout){var loadingTracker={};loadingTracker.loadingItems=[];loadingTracker.addPromise=function(promise){var trackingPromise=promise.catch(function(error){return'';});loadingTracker.loadingItems=loadingTracker.loadingItems.concat([trackingPromise]);return promise;};loadingTracker.onLoad=function(fn){var cancelled=false;var canceller=function(){cancelled=true;};$timeout(function(){$q.all(loadingTracker.loadingItems).then(function(){if(!cancelled)
$timeout(fn,0);});},0);return canceller;};loadingTracker.allLoaded=function(){return $timeout(function(){},0).then(function(){return $q.all(loadingTracker.loadingItems);});};return loadingTracker;}]);geekApp.controller('LoadingCtrl',['$scope','loadingTracker',function($scope,loadingTracker){$scope.loadingTracker=loadingTracker;}]);geekApp.directive('pinterestShareCount',['$http',function($http){var link=function(scope){$http.jsonp("//api.pinterest.com/v1/urls/count.json?url=http://"+encodeURIComponent(scope.url)).then(function(result){if(result.count!==0)
scope.sharecount=result.count;});};return{template:"{{sharecount}}",restrict:'E',link:link,scope:{'url':'@'}};}]);geekApp.directive('socialActionOptions',['domainname',function(domainname){return{controller:'SocialCtrl',controllerAs:'socialctrl',bindToController:true,restrict:'E',scope:{name:'=shareName',path:'=sharePath',imageUrl:'='},templateUrl:"geekoutput_socialactions.html"}}]);geekApp.controller('SocialCtrl',['domainname',function(domainname){this.$onInit=function(){this.url='https://'+domainname+this.path;};}]);geekApp.directive('focusOn',["$timeout",function($timeout){return function(scope,elem,attr){scope.$on(attr.focusOn,function(e){$timeout(function(){elem[0].focus();},300);});};}]);geekApp.directive('selectOnFocus',['$window',function($window){return{restrict:'A',link:function(scope,element){element.on('focus',function(){if(!$window.getSelection().toString()){this.setSelectionRange(0,this.value.length)}});}};}]);geekApp.directive('onEnter',function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){if(event.which===13){scope.$apply(function(){scope.$eval(attrs.onEnter,{'event':event});});event.preventDefault();}});};});geekApp.directive('facebookShareCount',['$http',function($http){var link=function(scope){$http.get("//graph.facebook.com/?id=http://"+scope.url).then(function(result){scope.sharecount=result.shares;});};return{template:"{{sharecount}}",restrict:'E',link:link,scope:{'url':'@'}};}]);geekApp.directive('selectOnShow',['$timeout',function($timeout){return{restrict:'A',link:function($scope,$element,$attr){var callback=function(newValue){if(newValue){$timeout(function(){$element[0].focus();if($element.val())
$element[0].setSelectionRange(0,$element.val().length);},0);}};if($attr.ngShow){$scope.$watch($attr.ngShow,callback);}
if($attr.ngHide){$scope.$watch($attr.ngHide,callback);}}};}]);geekApp.filter('partition',function(){var cache={};var filter=function(arr,size){if(!arr){return;}
var newArr=[];for(var i=0;i<arr.length;i+=size){newArr.push(arr.slice(i,i+size));}
var arrString=JSON.stringify(arr);var fromCache=cache[arrString+size];if(JSON.stringify(fromCache)===JSON.stringify(newArr)){return fromCache;}
cache[arrString+size]=newArr;return newArr;};return filter;});geekApp.decorator('$uibModal',['$delegate','$controller',function($delegate,$controller){var modalProvider={};angular.extend(modalProvider,$delegate);modalProvider.open=function(modalOptions){if(!modalOptions.confirmOnDismiss){return $delegate.open(modalOptions);}
var controllerName=modalOptions.controller;var controllerVars=['$scope','$uibModalInstance'].concat(_.keys(modalOptions.resolve));var bypassConfirm=function(){return false;};var controllerFunction=function(){var ctrlLocals=_.zipObject(controllerVars,arguments);var baseController=$controller(controllerName,ctrlLocals);angular.extend(this,baseController);var confirmDismissal=function(event,resultOrReason,closing){if(!closing&&resultOrReason!=='skipConfirm'&&!bypassConfirm()){event.preventDefault();var confirmer=$delegate.open({templateUrl:"geekoutput_modal_confirm.tpl",windowClass:"modal-confirm",size:"sm"});confirmer.result.then(function(){ctrlLocals.$scope.$dismiss('skipConfirm');},function(){});}};ctrlLocals.$scope.$on('modal.closing',confirmDismissal);};modalOptions.controller=controllerVars.concat(controllerFunction);var modalInstance=$delegate.open(modalOptions);modalInstance.setBypassConfirmCallback=function(condition){bypassConfirm=condition;};return modalInstance;};return(modalProvider);}]);geekApp.decorator('$state',['$delegate','loadingTracker','$q','$timeout',function($delegate,loadingTracker,$q,$timeout){var go=$delegate.go;var myGo=function(){var promise=go.apply($delegate,arguments);var delayedPromise=$q(function(resolve){promise.then(function(){$timeout(function(){resolve();},300);})});loadingTracker.addPromise(delayedPromise);return promise;};$delegate.go=myGo;return $delegate;}]);(function(){angular.module('googlechart').directive('agcOnClick',onClickDirective);function onClickDirective(){return{restrict:'A',scope:false,require:'googleChart',link:function(scope,element,attrs,googleChartController){callback.$inject=['args','chart','chartWrapper'];function callback(args,chart,chartWrapper){scope.$apply(function(){scope.$eval(attrs.agcOnClick,{args:args,chart:chart,chartWrapper:chartWrapper});});}
googleChartController.registerChartListener('click',callback,this);}};}})();
geekApp.controller('GeekOutput_HotnessCtrl',['$http','$scope','geekAPIUrls','domain',function($http,$scope,geekAPIUrls,domain){var that=this;this.url=geekAPIUrls.hotness;this.hotnessTypes=[{objecttype:'thing',label:'Games'},{objecttype:'person',label:'People'},{objecttype:'company',label:'Companies'}];this.getHotness=function(){$http.get(this.url,{params:this.params,cache:true}).then(function(response){that.data=response.data;});};this.setObjecttype=function(objecttype){this.params.objecttype=objecttype;this.getHotness();};this.$onInit=function(){this.params={showcount:this.showcount,objecttype:this.objecttype,geeksite:domain,nosession:1};this.getHotness();};}]);geekApp.controller('GeekOutput_LayoutCtrl',['geekitemSettings','$localStorage','$anchorScroll','domain','menus',function(geekItemSettings,$localStorage,$anchorScroll,domain,menus){var that=this;that.localStorage=$localStorage;that.ready=true;this.showOverlaySidebar=false;this.localStorage.hideFixedSidebar=this.localStorage.hideFixedSidebar||false;this.geekitemSettings=geekItemSettings;this.menu=menus[domain];this.toggleOverlaySidebar=function(){this.showOverlaySidebar=!this.showOverlaySidebar;};this.deactivateOverlaySidebar=function(){this.showOverlaySidebar=false;};that.skipToId=function(tag){var mainbody=document.getElementById(tag);mainbody.focus();$anchorScroll.yOffset=60;$anchorScroll(tag);}}]);geekApp.controller('GeekOutput_RecentCtrl',['$http','$localStorage',function($http,$localStorage){var that=this;that.$storage=$localStorage;this.url='/geektracker/api/v1/recentitems';this.params={ajax:1,objecttype:this.objecttype,domain:this.domain};this.getRecentlyViewed=function(){$http.get(this.url,{params:this.params,cache:true}).then(function(response){that.data=response.data;});};this.getRecentlyViewed();}]);
geekApp.directive('feedbackWidget',['$uibModal',function($modal){return{restrict:'A',controller:'GeekFeedbackCtrl',controllerAs:'feedbackctrl'}}]);geekApp.factory('feedbackHttpTools',['$http','loadingTracker',function($http,loadingTracker){var feedbackTools={};feedbackTools.saveFeedback=function(data){var url='/api/feedback';return $http.post(url,data);};return feedbackTools;}]);geekApp.controller('GeekFeedbackCtrl',['feedbackHttpTools','$uibModal',function(feedbackHttpTools,$modal){this.openFeedback=function(){$modal.open({controller:'GeekFeedbackDialogCtrl',windowClass:'modal-fixed-right',confirmOnDismiss:true,templateUrl:'geekoutput_dialog_feedback.tpl'});};}]);geekApp.controller('GeekFeedbackDialogCtrl',['$scope','$uibModalInstance','notify','feedbackHttpTools',function($scope,$uibModalInstance,notify,feedbackHttpTools){$scope.feedback={subject:'',body:''};var unchangedFeedback=angular.copy($scope.feedback);var dataIsUnchanged=function(){return angular.equals($scope.feedback,unchangedFeedback);};$uibModalInstance.setBypassConfirmCallback(dataIsUnchanged);$scope.save=function(){var data=$scope.feedback;$scope.errors={};if(!data.subject)
$scope.errors.subject=true;if(!data.body)
$scope.errors.body=true;if(!_.isEmpty($scope.errors))
return;$uibModalInstance.close();feedbackHttpTools.saveFeedback(data).then(function(response){notify(response.data.message);},function error(response){$uibModalInstance.close();notify({message:response.data.message,classes:'alert-danger'});});};}]);
geekApp.constant('searchOptions',{boardgame:[{objecttype:'boardgame',name:'Board Games',jsonSearchable:true},{objecttype:'boardgameartist',name:'Artists',jsonSearchable:true},{objecttype:'boardgamedesigner',name:'Designers',jsonSearchable:true},{objecttype:'boardgamepublisher',name:'Publishers',jsonSearchable:true},{objecttype:'boardgameaccessory',name:'Accessories',jsonSearchable:true},{objecttype:'boardgamefamily',name:'Families',jsonSearchable:true},{objecttype:'article',name:'Forums',jsonSearchable:false},{objecttype:'geeklist',name:'GeekLists',jsonSearchable:false},{objecttype:'boardgamehonor',name:'Honors',jsonSearchable:true},{objecttype:'tag',name:'Tags',jsonSearchable:false},{objecttype:'wiki',name:'Wiki',jsonSearchable:false},{objecttype:'user',name:'Users',jsonSearchable:false},{objecttype:'boardgamepodcast',name:'Podcasts',jsonSearchable:false},{objecttype:'boardgamepodcastepisode',name:'Podcast Ep.',jsonSearchable:false}],rpg:[{objecttype:'rpgunified',name:'All',jsonSearchable:true},{objecttype:'rpgitem',name:'RPG Items',jsonSearchable:true},{objecttype:'rpg',name:'RPGs',jsonSearchable:true},{objecttype:'rpgsystem',name:'Systems',jsonSearchable:true},{objecttype:'rpgseries',name:'Series',jsonSearchable:true},{objecttype:'rpgsetting',name:'Settings',jsonSearchable:true},{objecttype:'rpgdesigner',name:'Designers',jsonSearchable:true},{objecttype:'rpgartist',name:'Artists',jsonSearchable:true},{objecttype:'rpgproducer',name:'Production Staff',jsonSearchable:true},{objecttype:'rpgpublisher',name:'Publishers',jsonSearchable:true},{objecttype:'article',name:'Forums',jsonSearchable:false},{objecttype:'geeklist',name:'GeekLists',jsonSearchable:false},{objecttype:'tag',name:'Tags',jsonSearchable:false},{objecttype:'wiki',name:'Wiki',jsonSearchable:false},{objecttype:'user',name:'Users',jsonSearchable:false},{objecttype:'rpgperiodical',name:'Periodicals',jsonSearchable:true},{objecttype:'rpgissue',name:'Issues',jsonSearchable:true},{objecttype:'rpgissuearticle',name:'Articles',jsonSearchable:true},{objecttype:'rpgpodcast',name:'Podcasts',jsonSearchable:false},{objecttype:'rpgpodcastepisode',name:'Podcast Ep.',jsonSearchable:false}],videogame:[{objecttype:'videogameunified',name:'All',jsonSearchable:true},{objecttype:'videogame',name:'Video Games',jsonSearchable:true},{objecttype:'videogameplatform',name:'Platforms',jsonSearchable:true},{objecttype:'videogamehardware',name:'Hardware',jsonSearchable:true},{objecttype:'videogamefranchise',name:'Franchises',jsonSearchable:true},{objecttype:'videogameseries',name:'Series',jsonSearchable:true},{objecttype:'videogametheme',name:'Themes',jsonSearchable:true},{objecttype:'videogamegenre',name:'Genres',jsonSearchable:true},{objecttype:'videogamecharacter',name:'Characters',jsonSearchable:true},{objecttype:'videogamedeveloper',name:'Developers',jsonSearchable:true},{objecttype:'videogamepublisher',name:'Publishers',jsonSearchable:false},{objecttype:'article',name:'Forums',jsonSearchable:false},{objecttype:'geeklist',name:'GeekLists',jsonSearchable:false},{objecttype:'tag',name:'Tags',jsonSearchable:false},{objecttype:'wiki',name:'Wiki',jsonSearchable:false},{objecttype:'user',name:'Users',jsonSearchable:false}]});geekApp.constant('menus',(function(){var menus={};var geeklistSection={id:'geeklists',name:'GeekLists',sections:[{lists:[{links:[{href:'/geeklist/lists?sortby=hot&interval=twodays',anchor:'Hot'},{href:'/geeklist/lists?sortby=date',anchor:'Recent'},{href:'/geeklist/lists?sortby=active',anchor:'Active'},{href:'/geeklist/favorites',anchor:'Favorites'},{href:'/geeklist/mylists',anchor:'My Geeklists'},{href:'/geeklist/new',anchor:'Create New'}]}]}]};menus.boardgame=[{id:'browse',name:'Browse',wide:true,sections:[{lists:[{links:[{href:'/browse/boardgame',anchor:'All Boardgames'},{href:'/browse/boardgamecategory',anchor:'Categories'},{href:'/browse/boardgameartist',anchor:'Artists'},{href:'/browse/boardgamepublisher',anchor:'Publishers'},{href:'/browse/boardgamehonor',anchor:'Honors'},{href:'/gonecardboard',anchor:'Gone Cardboard'},{href:'/recentadditions',anchor:'Recent Additions'}]},{links:[{href:'/browse/boardgamefamily',anchor:'Families'},{href:'/browse/boardgamemechanic',anchor:'Mechanics'},{href:'/browse/boardgamedesigner',anchor:'Designers'},{href:'/browse/boardgameaccessory',anchor:'Accessories'},{href:'/boardgame/random',anchor:'Random Game'},{href:'/browse/boardgamepodcast',anchor:'Podcasts'},{href:'/wiki/page/Index',anchor:'Wiki'}]}]}]},{id:'forums',name:'Forums',wide:true,sections:[{lists:[{links:[{href:'/forums/region/1/boardgamegeek',anchor:'All Forums'},{href:'/thread/browse/region/1?sort=recent',anchor:'Recent'},{href:'/forum/search/region/1',anchor:'Search'},{href:'/wiki/page/admins',anchor:'Moderators'},{href:'/subscriptions',anchor:'Subscriptions'}]},{links:[{href:'/thread/browse/region/1?sort=hot&days=2',anchor:'Hot'},{href:'/thread/browse/region/1?sort=active',anchor:'Active'},{href:'/article/create/region/1',anchor:'Post Thread'},{href:'/thread/bookmarks',anchor:'Bookmarks'},{href:'/community_rules',anchor:'Rules'}]}]}]},geeklistSection,{id:'marketplace',name:'Shopping',sections:[{lists:[{links:[{href:'/geekmarket',anchor:'Geek Market'},{href:'/trade',anchor:'Trades'},{href:'https://geekgameshop.com',anchor:'Geek Game Shop'},{href:'https://boardgamegeekstore.com',anchor:'BGG Store'},{href:'/geekshopper',anchor:'Auction Search'},{href:'/geekbay/browse?sort=hot',anchor:'eBay Listings'}]}]}]},{id:'community',name:'Community',wide:true,sections:[{lists:[{links:[{href:'/guild/home',anchor:'Guilds'},{href:'/geekchat',anchor:'GeekChat'},{href:'/stats.php',anchor:'Stats'},{href:'/recentadditions',anchor:'RSS Feeds'},{href:'/users?showavatar=1',anchor:'Avatars'},{href:'/microbadges',anchor:'Microbadges'},{href:'/geekexchange/browse',anchor:'GeekExchange'}]},{links:[{href:'/geekmod',anchor:'GeekMod'},{href:'/geekquestions',anchor:'GeekQuestions'},{href:'/users.php',anchor:'Find Users'},{href:'/tags/cloud',anchor:'Tag Cloud'},{href:'/forum/88/boardgamegeek/bgg-bugs',anchor:'Bugs'},{href:'/geekads/manager',anchor:'Ad Manager'},{href:'/collection/current',anchor:'Geek Current'}]}]},{header:"Submitted Content",lists:[{links:[{href:'/files/boardgame/all',anchor:'Files'},{href:'/thread/browse/boardgame/0?sort=recent&forumname=reviews',anchor:'Reviews'},{href:'/videos/boardgame/all',anchor:'Videos'},{href:'/browse/boardgamepodcast',anchor:'Podcasts'}]},{links:[{href:'/images/boardgame/all?sort=recent',anchor:'Images'},{href:'/thread/browse/boardgame/0?sort=recent&forumname=sessions',anchor:'Session Reports'},{href:'/blogs',anchor:'Blogs'},{href:'/browse/boardgamepodcastepisode',anchor:'Podcast Episodes'}]}]},{header:"Contribute",lists:[{links:[{href:'/item/create/boardgame',anchor:'Board Game'},{href:'/item/create/boardgamefamily',anchor:'Family'},{href:'/item/create/boardgamepublisher',anchor:'Publisher'}]},{links:[{href:'/item/create/boardgameperson',anchor:'Person'},{href:'/item/create/boardgameaccessory',anchor:'Accessory'},{href:'/item/create/boardgamepodcast',anchor:'Podcast'}]}]},{requireAccess:"itemmgr",lists:[{links:[{href:'/item/create/bgaccessoryfamily',anchor:'Accessory Family'},{href:'/item/create/awardset',anchor:'Award Set'},{href:'/item/create/awardcategory',anchor:'Award Category'},{href:'/item/create/boardgameperiodical',anchor:'Periodical'}]},{links:[{href:'/item/create/award',anchor:'Award'},{href:'/item/create/awardposition',anchor:'Award Position'},{href:'/item/create/boardgamehonor',anchor:'BG Honor'},{href:'/item/create/boardgameevent',anchor:'Event'}]}]}]},{id:'help',name:'Help',sections:[{lists:[{links:[{href:'/wiki/page/Welcome_to_BoardGameGeek',anchor:'Welcome to BGG'},{href:'/wiki/page/Guide_To_BoardGameGeek',anchor:'Guide to BGG'},{href:'/wiki/page/BoardGameGeek_FAQ',anchor:'FAQ'},{href:'/wiki/page/Glossary',anchor:'Glossary'},{href:'/wiki/page/Admins',anchor:'Admins'}]}]}]}];menus.videogame=[{id:'browse',name:'Browse',wide:true,sections:[{lists:[{links:[{href:'/browse/videogame',anchor:'Video Games'},{href:'/browse/videogametheme',anchor:'Themes'},{href:'/browse/videogameseries',anchor:'Series'},{href:'/browse/videogamecharacter',anchor:'Characters'},{href:'/browse/videogamehardwarecategory',anchor:'Hardware Categories'},{href:'/browse/videogamepublisher',anchor:'Publishers'},{href:'/browse/videogamerating',anchor:'Rating'},{href:'/wiki/page/index',anchor:'Wiki'},{href:'/videogame/random',anchor:'Random Video Game'}]},{links:[{href:'/browse/videogamegenre',anchor:'Genres'},{href:'/browse/videogamefranchise',anchor:'Franchises'},{href:'/browse/videogameplatform',anchor:'Platforms'},{href:'/browse/videogamehardware',anchor:'Hardware'},{href:'/browse/videogamedeveloper',anchor:'Developers'},{href:'/browse/videogamehwmfg',anchor:'HW Manufacturers'},{href:'/browse/videogamemode',anchor:'Modes'},{href:'/recentadditions',anchor:'Recent Additions'}]}]}]},{id:'forums',name:'Forums',wide:true,sections:[{lists:[{links:[{href:'/forums/region/3/videogame',anchor:'All Forums'},{href:'/thread/browse/region/3?sort=recent',anchor:'Recent'},{href:'/forum/search/region/3',anchor:'Search'},{href:'/wiki/page/admins',anchor:'Moderators'},{href:'/subscriptions',anchor:'Subscriptions'}]},{links:[{href:'/thread/browse/region/3?sort=hot&days=2',anchor:'Hot'},{href:'/thread/browse/region/3?sort=active',anchor:'Active'},{href:'/article/create/region/3',anchor:'Post Thread'},{href:'/thread/bookmarks',anchor:'Bookmarks'},{href:'/community_rules',anchor:'Rules'}]}]}]},geeklistSection,{id:'marketplace',name:'Shopping',sections:[{lists:[{links:[{href:'/geekmarket',anchor:'Geek Market'},{href:'/trade',anchor:'Trades'},{href:'/geekbay/browse?sort=hot',anchor:'eBay Listings'}]}]}]},{id:'community',name:'Community',wide:true,sections:[{lists:[{links:[{href:'/guild/home',anchor:'Guilds'},{href:'/geekchat',anchor:'GeekChat'},{href:'/recentadditions',anchor:'RSS Feeds'},{href:'/users?showavatar=1',anchor:'Avatars'},{href:'/microbadges',anchor:'Microbadges'},{href:'/geekexchange/browse',anchor:'GeekExchange'}]},{links:[{href:'/geekmod',anchor:'GeekMod'},{href:'/geekquestions',anchor:'GeekQuestions'},{href:'/users.php',anchor:'Find Users'},{href:'/tags/cloud',anchor:'Tag Cloud'},{href:'/forum/796528/video-game/vgg-bugs',anchor:'Bugs'},{href:'/geekads/manager',anchor:'Ad Manager'},{href:'/collection/current',anchor:'Geek Current'}]}]},{header:"Submitted Content",lists:[{links:[{href:'/files/videogame/all',anchor:'Files'},{href:'/thread/browse/videogame/0?sort=recent&forumname=reviews',anchor:'Reviews'},{href:'/videos/videogame/all',anchor:'Videos'}]},{links:[{href:'/images/rpgitem/all?sort=recent',anchor:'Images'},{href:'/blogs',anchor:'Blogs'}]}]},{header:"Contribute",lists:[{links:[{href:'/item/create/videogame',anchor:'Video Game'},{href:'/item/create/videogameseries',anchor:'Series'},{href:'/item/create/videogamehardware',anchor:'Hardware'}]},{links:[{href:'/item/create/videogamefranchise',anchor:'Franchise'},{href:'/item/create/videogamecharacter',anchor:'Character'},{href:'/item/create/videogamecompany',anchor:'Company'}]}]},{requireAccess:"itemmgr",lists:[{links:[{href:'/item/create/videogamegenre',anchor:'Genre'},{href:'/item/create/videogamemode',anchor:'Mode'},{href:'/item/create/videogametheme',anchor:'Theme'},{href:'/item/create/videogameplatform',anchor:'Platform'},{href:'/item/create/videogamerating',anchor:'Rating'}]},{links:[{href:'/item/create/vgcharactercat',anchor:'Character Type'},{href:'/item/create/videogamemedia',anchor:'Media'},{href:'/item/create/videogamehonor',anchor:'VG Honor'},{href:'/item/create/videogameevent',anchor:'Event'}]}]}]},{id:'help',name:'Help',sections:[{lists:[{links:[{href:'/wiki/page/VGG_User_Guide',anchor:'User Guide'},{href:'/wiki/page/VGG_FAQ',anchor:'FAQ'},{href:'/wiki/page/VGG_Glossary',anchor:'Glossary'},{href:'/wiki/page/Video_Game_Guide_to_Data_Entry',anchor:'Data Entry Guide'},{href:'/wiki/page/VGG_Image_Policy',anchor:'Image Policy'},{href:'/wiki/page/Admins#vgg',anchor:'VGG Admins'},{href:'/wiki/page/About_VGG',anchor:'About'}]}]}]}];menus.rpg=[{id:'browse',name:'Browse',wide:true,sections:[{lists:[{links:[{href:'/rpgitem/random',anchor:'Random RPG Item'},{href:'/browse/rpgitem',anchor:'RPG Items'},{href:'/browse/rpgdesigner',anchor:'Designers'},{href:'/browse/rpgartist',anchor:'Artists'},{href:'/browse/rpggenre',anchor:'Genres'},{href:'/browse/rpgsystem',anchor:'Systems'},{href:'/browse/rpgsetting',anchor:'Settings'},{href:'/browse/rpgmechanic',anchor:'Mechanics'},{href:'/browse/rpgpodcast',anchor:'Podcasts'},{href:'/wiki/page/index',anchor:'Wiki'},{href:'/recentadditions',anchor:'Recent Additions'}]},{links:[{href:'/rpg/random',anchor:'Random RPG'},{href:'/browse/rpg',anchor:'RPGs'},{href:'/browse/rpgpublisher',anchor:'Publishers'},{href:'/browse/rpgproducer',anchor:'Production'},{href:'/browse/rpgfamily',anchor:'Families'},{href:'/browse/rpgseries',anchor:'Series'},{href:'/browse/rpgcategory',anchor:'Categories'},{href:'/browse/rpgperiodical',anchor:'Periodicals'},{href:'/browse/rpgissue',anchor:'Issues'},{href:'/browse/rpgissuearticle',anchor:'Articles'}]}]}]},{id:'forums',name:'Forums',wide:true,sections:[{lists:[{links:[{href:'/forums/region/2/rpg',anchor:'All Forums'},{href:'/thread/browse/region/2?sort=recent',anchor:'Recent'},{href:'/forum/search/region/2',anchor:'Search'},{href:'/wiki/page/admins',anchor:'Moderators'},{href:'/subscriptions',anchor:'Subscriptions'}]},{links:[{href:'/thread/browse/region/2?sort=hot&days=2',anchor:'Hot'},{href:'/thread/browse/region/2?sort=active',anchor:'Active'},{href:'/article/create/region/2',anchor:'Post Thread'},{href:'/thread/bookmarks',anchor:'Bookmarks'},{href:'/community_rules',anchor:'Rules'}]}]}]},geeklistSection,{id:'marketplace',name:'Shopping',sections:[{lists:[{links:[{href:'/geekmarket',anchor:'Geek Market'},{href:'/trade',anchor:'Trades'},{href:'/geekbay/browse?sort=hot',anchor:'eBay Listings'}]}]}]},{id:'community',name:'Community',wide:true,sections:[{lists:[{links:[{href:'/guild/home',anchor:'Guilds'},{href:'/geekchat',anchor:'GeekChat'},{href:'/recentadditions',anchor:'RSS Feeds'},{href:'/users?showavatar=1',anchor:'Avatars'},{href:'/microbadges',anchor:'Microbadges'},{href:'/geekexchange/browse',anchor:'GeekExchange'}]},{links:[{href:'/geekmod',anchor:'GeekMod'},{href:'/geekquestions',anchor:'GeekQuestions'},{href:'/users.php',anchor:'Find Users'},{href:'/tags/cloud',anchor:'Tag Cloud'},{href:'/forum/372973/rpg/rpggeek-bugs',anchor:'Bugs'},{href:'/geekads/manager',anchor:'Ad Manager'},{href:'/collection/current',anchor:'Geek Current'}]}]},{header:"Submitted Content",lists:[{links:[{href:'/files/rpgitem/all',anchor:'Files'},{href:'/thread/browse/rpgitem/0?sort=recent&forumname=reviews',anchor:'Reviews'},{href:'/videos/rpgitem/all',anchor:'Videos'},{href:'/browse/rpgpodcast',anchor:'Podcasts'}]},{links:[{href:'/images/rpgitem/all?sort=recent',anchor:'Images'},{href:'/thread/browse/rpgitem/0?sort=recent&forumname=sessions',anchor:'Session Reports'},{href:'/blogs',anchor:'Blogs'},{href:'/browse/rpgpodcastepisode',anchor:'Podcast Episodes'}]}]},{header:"Contribute",lists:[{links:[{href:'/item/create/rpgitem',anchor:'RPG Item'},{href:'/item/create/rpgseries',anchor:'Series'},{href:'/item/create/rpgperson',anchor:'Person'},{href:'/item/create/rpgperiodical',anchor:'Periodical'}]},{links:[{href:'/item/create/rpg',anchor:'RPG'},{href:'/item/create/rpgsetting',anchor:'Setting'},{href:'/item/create/rpgpublisher',anchor:'Company'},{href:'/item/create/rpgpodcast',anchor:'Podcast'}]}]},{requireAccess:"itemmgr",lists:[{links:[{href:'/item/create/rpgsystem',anchor:'System'},{href:'/item/create/rpggenre',anchor:'Genre'},{href:'/item/create/rpgmechanic',anchor:'Mechanic'},{href:'/item/create/rpgperiodical',anchor:'Periodical'},{href:'/item/create/rpgfamily',anchor:'Family'},{href:'/item/create/rpgcategory',anchor:'Category'}]},{links:[{href:'/item/create/award',anchor:'Award'},{href:'/item/create/awardset',anchor:'Award Set'},{href:'/item/create/awardposition',anchor:'Award Position'},{href:'/item/create/awardcategory',anchor:'Award Category'},{href:'/item/create/rpghonor',anchor:'RPG Honor'},{href:'/item/create/rpgevent',anchor:'Event'}]}]}]},{id:'help',name:'Help',sections:[{lists:[{links:[{href:'/wiki/page/Welcome',anchor:'Welcome to RPGG'},{href:'/wiki/page/User_Guide',anchor:'User Guide'},{href:'/wiki/page/RPG_Glossary',anchor:'RPG Glossary'},{href:'/wiki/page/RPGG_Guide_to_Data_Entry',anchor:'Data Entry Guide'},{href:'/wiki/page/RPGG_Image_Policy',anchor:'Image Policy'},{href:'/wiki/page/Admins#rpgg',anchor:'RPG Admins'},{href:'/wiki/page/RPG_Geek',anchor:'About RPG Geek'}]}]}]}];return menus;})());geekApp.directive('mainMenuDropdown',[function(){return{restrict:'E',templateUrl:'geekoutput_nav_menu_dropdown.html',scope:{dropdown:'=',activeSubmenu:'='},replace:true}}]);geekApp.controller('NavCtrl',['$scope','$window','geekAccount','domain','menus',function($scope,$window,geekAccount,domain,menus){var that=this;var logos={boardgame:"https://cf.geekdo-static.com/images/logos/navbar-logo-bgg-b2.svg",rpg:"https://cf.geekdo-static.com/images/logos/navbar-logo-rpgg-b2.svg",videogame:"https://cf.geekdo-static.com/images/logos/navbar-logo-vgg-b2.svg"};that.advSearchUrl="/advsearch/"+domain;that.logo=logos[domain];that.domain=domain;this.menu=menus[domain];this.searchVars={};this.searchVars.mobileSearch=false;this.menuVars={};this.menuVars.mobileNavOpen=false;this.menuVars.activeSubmenu=null;this.loaded=false;geekAccount.getUserPromise.then(function(currentUser){that.currentUser=currentUser;that.loaded=true;});this.closeQuickbar=function(){if(!this.searchVars.isShortcutting)
return;if(!angular.element(document.body).hasClass('modal-open')){this.searchVars.isShortcutting=false;}};this.closeMobileMenu=function(){this.menuVars.mobilenav=false;};angular.element($window).on('resize',function(){if($window.innerWidth>SCREEN_LG){that.searchVars.mobileSearch=false;$scope.$digest();}});}]);geekApp.controller('GeekSearch',['$scope','searchOptions','$window','$http','domain',function($scope,searchOptions,$window,$http,domain){this.searchOptions=searchOptions[domain];this.searchEmpty=true;this.jsonSearch=function(q){if(_.find(this.searchOptions,{objecttype:this.search.objecttype,jsonSearchable:true})===undefined)
return[];return $http.get('search/'+this.search.objecttype,{params:{q:q,showcount:20}}).then(function(response){return response.data.items;})};this.goToItem=function(item){window.location.href=item.href;};this.unfocus=function(){this.searchfocus=false;};var defaultSearchTypes={boardgame:'boardgame',rpg:'rpgunified',videogame:'videogameunified'};this.search={'action':'search','objecttype':defaultSearchTypes[domain],'q':''};this.activateSearch=function(){$scope.$broadcast('searchActivated');};this.searchOnEnter=function(keyEvent){if(keyEvent.which===13){this.fullSearch();}};this.fullSearch=function(){if(!this.search.q){this.activateSearch();return;}
var url="/geeksearch.php?";var query=[];angular.forEach(this.search,function(value,key){query.push(key+'='+encodeURIComponent(value));});$window.location.href=url+query.join('&');}}]);geekApp.factory("quickbarTools",['$resource','loadingTracker','notify','$location','$http',function($resource,loadingTracker,notify,$location,$http){var that={anyShortcuts:false,loaded:false};var Shortcut=$resource('/api/shortcuts/:id',{id:'@id'});that.pages=_.range(1,11);var standardizeShortcuts=function(rawshortcuts){var index=0;var shortcuts=[];for(var page=1;page<=10;page++){shortcuts[page]=[];for(var i=0;i<10;i++){if(rawshortcuts[index]&&rawshortcuts[index].page==page&&rawshortcuts[index].index==i){that.anyShortcuts=true;shortcuts[page][i]=rawshortcuts[index];index+=1;}else{shortcuts[page][i]={};}
shortcuts[page][i].index=i;}}
if(!that.anyShortcuts)
that.anyShortcuts=false;that.shortcuts=shortcuts;};that.loadShortcuts=function(){$http.get('/api/shortcuts').then(function(rawshortcuts){that.loaded=true;if(rawshortcuts.data){standardizeShortcuts(rawshortcuts.data.shortcuts);that.page=rawshortcuts.data.meta.page;}},function(){return null});};loadingTracker.allLoaded().then(that.loadShortcuts);that.deleteShortcut=function(shortcut){$http.delete('/api/shortcuts/'+shortcut.id).then(function(){that.loadShortcuts();},function(){return null});};that.setPage=function(page){that.page=page;$http.put('/api/shortcutspage',{page:page});}
that.saveShortcut=function(label,page,index){var newShortcut=new Shortcut({label:label,url:$location.absUrl()});if(page){newShortcut.page=page;newShortcut.index=index;}
newShortcut.$save({},function(response){that.loadShortcuts();},function(response){var message=response.data.message?response.data.message:"Something went wrong";notify({message:message,classes:'alert-warning'});});}
return that;}]);geekApp.controller('QuickBarCtrl',['quickbarTools','$uibModal','$document','$rootScope',function(quickbarTools,$modal,$document,$rootScope){var that=this;this.quickbarTools=quickbarTools;this.addShortcut=function(page,index){var scope=$rootScope.$new(true);var title=$document[0].title;scope.newShortcutLabel=title.substring(0,title.indexOf('|')-1);var modalInstance=$modal.open({scope:scope,templateUrl:"addShortcut.html",size:'sm'});modalInstance.rendered.then(function(){$rootScope.$broadcast('shortcutModalOpen');});modalInstance.result.then(function(label){that.quickbarTools.saveShortcut(label,page,index);});};this.deleteShortcut=function(shortcut){var modalInstance=$modal.open({templateUrl:"deleteShortcutConfirm.html",size:'sm'});modalInstance.result.then(function(){that.quickbarTools.deleteShortcut(shortcut);});}}]);geekApp.controller('QuickbarLinkCtrl',['notify','$scope',function(notify,$scope){this.invalidLinkClicked=function(){notify({messageTemplate:"<span>To improve site security, relative urls and javascript are "+"no longer permitted in the quickbar. Relative URLs can be fixed by editing the quickbar links. "+"If you want javascript functionality, we suggest you "+"<a target='_blank' href='https://www.howtogeek.com/189358/beginner-geek-how-to-use-bookmarklets-on-any-device/'>"+"add the javascript snippet</a> to your "+"browser bookmarks.</span>",classes:'alert-warning'});};}]);geekApp.directive('geeknavMenu',function(){return{controller:'NavCtrl',controllerAs:'navctrl',bindToController:true,replace:true,templateUrl:'geekoutput_nav_menu.tpl'}});geekApp.directive('geekHrefPagination',['$sce',function($sce){return{link:function(scope){var maxLinks=5;var totalPages=Math.ceil(scope.itemcount / scope.showcount);scope.pages=[];if(totalPages<=1)
return;var addPages=function(first,last){for(i=first;i<=last;i++){scope.pages.push({label:i,href:scope.href+"/page/"+i});}}
if(totalPages<=maxLinks){addPages(1,totalPages);}else{var halfCount=Math.floor(maxLinks / 2);addPages(1,halfCount);scope.pages.push({label:$sce.trustAsHtml("&hellip;")});addPages(totalPages-halfCount+1,totalPages);}},restrict:'E',templateUrl:'geek_href_pagination.html',scope:{showcount:'=',itemcount:'=',href:'='}};}]);
geekApp.factory('adHttpTools',['$http','loadingTracker',function($http,loadingTracker){var adtools={};adtools.getAd=function(item){return loadingTracker.allLoaded().then(function(){return $http.get('/api/geekads',{params:{objecttype:item.objecttype,objectid:item.objectid,showcount:1,nosession:1}});});};return adtools;}]);geekApp.controller('TextAdCtrl',['adHttpTools','$scope',function(adHttpTools,$scope){$scope.getAd=function(){var params={objecttype:$scope.objecttype,objectid:$scope.objectid};adHttpTools.getAd(params).then(function(response){$scope.ad=response.data;});};$scope.getAd();}]);geekApp.directive('fetchTextAd',[function(){return{restrict:'E',scope:{objecttype:'=',objectid:'='},template:'<text-ad ng-if="ad" ad-data="ad"></text-ad>',controller:'TextAdCtrl'}}]);geekApp.directive('textAd',function(){var link=function(scope,elements,attrs,ctrl){if(scope.ad.adid)
scope.ad.url="/geekads/click/"+scope.ad.adid;if(scope.ad.username){scope.ad.sponsorname=scope.ad.username;scope.ad.sponsorurl="/user/"+scope.ad.username;}};return{restrict:'E',scope:{ad:'=adData'},templateUrl:'geekitem_textad.tpl',link:link};});geekApp.directive('textAdsModule',[function(){var link=function(scope,elements,attrs,ctrl){ctrl.url='/api/geekads';ctrl.getModule();};return{scope:{params:'&'},controller:'GeekItem_ModuleCtrl',controllerAs:'textadsctrl',bindToController:true,link:link,templateUrl:'geekitem_module_textads.tpl'}}]);geekApp.directive('hideAdBlock',['adBlock','adConfig',function(adBlock,adConfig){return{restrict:'A',transclude:'element',link:function(scope,element,attrs,ctrl,$transclude){if(!adBlock[attrs.hideAdBlock]&&!adConfig[attrs.hideAdBlock]){$transclude(function(clone){element.after(clone);});}}};}]);geekApp.directive('targetcoTextAd',[function(){return{restrict:'E',scope:{url:'='},templateUrl:"targetco_text_ad.tpl"};}]);geekApp.directive('riotTextAd',[function(){return{restrict:'E',templateUrl:'riotgames_text_ad.tpl',replace:true};}]);geekApp.directive('walmartTextAd',[function(){return{restrict:'E',scope:{walmartid:'=',walmartprice:'='},templateUrl:"walmart_text_ad.tpl"};}]);
moment.locale('en-geek',{calendar:{lastDay:'[Yesterday at] h:mm a',sameDay:'[Today at] h:mm a',nextDay:'[Tomorrow at] h:mm a',lastWeek:'MMM D, YYYY',nextWeek:'dddd [at] h:mm a',sameElse:"MMM D, YYYY"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"1 minute",mm:"%d minutes",h:"1 hour",hh:"%d hours",d:"1 day",dd:"%d days",M:"1 month",MM:"%d months",y:"1 year",yy:"%d years"}});moment.locale('en-geek-compact',{relativeTime:{future:"in %s",past:"%s",s:"%ds",m:"1min",mm:"%dmin",h:"1h",hh:"%dh",d:"1d",dd:"%dd",M:"1mo",MM:"%dmo",y:"1y",yy:"%dy"}});moment.locale('en-geek');geekApp.factory('timeZoneService',function(){var timeZoneService={};timeZoneService.timezone=jstz.determine().name();return timeZoneService;});geekApp.filter('activeTabs',[function(){return function(tabs){return _.filter(tabs,function(tab){return tab.active||tab.forceActive;});};}]);geekApp.filter('geekdate',['$filter',function($filter){return function(date,format){return $filter('geekdatetime')(date+' 00:00:00',format,'America/Chicago');}}]);geekApp.filter('geekdatetime',['timeZoneService','geekitemSettings',function(timeZoneService,geekitemSettings){var dateTimeFilter=function(datetime,format,timezone){if(!timezone)
timezone=timeZoneService.timezone;var m=moment.tz(datetime,'America/Chicago').tz(timezone);if(!m.isValid())
return null;var result;switch(format){case'calendardate':var customformat={lastDay:'[Yesterday]',sameDay:'[Today]',nextDay:'[Tomorrow]',lastWeek:'MMM D, YYYY',nextWeek:'dddd',sameElse:'MMM D, YYYY'};result=m.calendar(null,customformat);break;case'monthyear':result=m.format('MMM YYYY');break;case'calendar':result=m.calendar();break;case'briefdate':result=m.format('MMM D');if(m.year()!==moment().year())
result+=m.format(', YYYY');break;case'absdate':result=m.format('YYYY-MM-DD');break;case'compactrelative':if(geekitemSettings&&geekitemSettings.absolutedates)
result=m.format('YYYY-MM-DD');else
result=m.locale('en-geek-compact').fromNow();default:if(geekitemSettings&&geekitemSettings.absolutedates)
result=m.format('YYYY-MM-DD');else
result=m.fromNow();}
return result;};return _.memoize(dateTimeFilter,function(datetime,format,timezone){return datetime+format+timezone;});}]);geekApp.filter('playDuration',function(){return function(minutes){var m=minutes%60;var h=Math.floor(minutes / 60);var result='';if(h)
result+=h+"h ";if(m)
result+=m+"m";return result;};});geekApp.filter('PTduration',function(){return function(duration){if(duration==='N/A')
return'';var mduration=moment.duration(duration);if(mduration.asSeconds()<60){return mduration.format("mm:ss",{trim:false});}else{return mduration.format("h:mm:ss");}};});geekApp.filter('partialDate',['$filter',function($filter){return function(date){var regexp=/^([0-9]{4})\-([0-9]{2})\-([0-9]{2})$/;var match=regexp.exec(date);var year=match[1];var month=match[2];var day=match[3];var format="";if(month=='00'){format='y';month='01';day='01';}
else
if(day=='00'){day='01';format='MMM y';}
else{format="MMM d, y";}
date=year+'-'+month+'-'+day;return $filter('date')(date,format);}}]);geekApp.filter('ratingColor',['$filter',function($filter){return function(num){if(!num)
return num;return Math.floor($filter('number')(num,1));};}]);geekApp.filter('ratingNumber',['$filter',function($filter){return function(num){if(num==10)
return $filter('number')(num,0);else
return $filter('number')(num,1);};}]);geekApp.filter('propertyIn',function(){return function(objects,key,filterArr){return _.filter(objects,function(obj){return _.indexOf(filterArr,_.get(obj,key),true)>=0;});};});geekApp.filter('propertyInObjectKeys',function(){return function(objects,key,filterObj){return _.filter(objects,function(obj){return _.has(filterObj,_.get(obj,key));});};});geekApp.filter('normalizeWhitespace',function(){return function(str){if(!str)
return;return str.replace(/\s+/g," ").trim();};});geekApp.filter('userRatingNumber',['$filter',function($filter){return function(num){if(num===null)
return num;var firstDecimal=Math.round(num*10)%10;if(firstDecimal==0){return $filter('number')(num,0);}else{return $filter('number')(num,1);}};}]);geekApp.filter('filetypeFromFilename',function(){return function(filename){if(filename===null)
return null;var result=filename.match(/\.(\w+)$/);return result?result[1]:'--';}});geekApp.filter('removeMultipleBreaks',function(){return function(str){str=str.replace(/<a[^>]*><\/a>/g,'');str=str.replace(/(<br \/>\s*){3,}/g,'<br /><br />');return str.replace(/^(\s*<br \/>\s*)+/g,'');}});geekApp.filter('stripBreaks',function(){return function(str){if(str){str=str.replace(/<br \/>\s*/g,' ');return str.replace(/^(\s*<br \/>\s*)+/g,'');}};});geekApp.filter('stripImages',function(){return function(str){if(str)
return str.replace(/<img\s[^>]*?>/igm,'[IMAGE]');};});geekApp.filter('stripGames',function(){return function(str){if(str)
return str.replace(/ Games/,'');}});geekApp.filter('humanize',function(){return function humanize(number,showdigits){if(!number||number<1000){return number;}
var si=['K','M','G','T','P','H'];var exp=Math.floor(Math.log(number)/ Math.log(1000));var result=number / Math.pow(1000,exp);showdigits=showdigits?showdigits:2;var digits=Math.floor(Math.log(result)/ Math.log(10))+1;showdigits=Math.max(digits,showdigits);var rounded=Math.round(result*Math.pow(10,showdigits-digits))/ Math.pow(10,showdigits-digits);return rounded+si[exp-1];};});geekApp.filter('toRange',function(){return function(arr){if(!arr)
return;if(!arr.length)
return"none";return _.reduce(arr,function(result,el,key){var val='';if(el.max==el.min)
val=el.max;else
if(el.max&&el.min)
val=el.min+'–'+el.max;else
if(((key-1)in arr)&&(el.min-1)==arr[key-1].max)
val='+';else
val=el.min+'+';if(key>0&&val!='+')
val=', '+val;return result+val;},'');};});geekApp.filter('fieldFromArrayById',['$filter',function($filter){return function(arr,idName,id,field,defaultVal){var anyValueFalse=_.some(arr,function(value){return!value[idName];});if(!arr||(!id&&!anyValueFalse)||id==='all'){return defaultVal;}
var expression={};expression[idName]=id;var filtered=_.find(arr,expression);return filtered?filtered[field]:defaultVal;};}]);geekApp.filter('to_trusted',['$sce',function($sce){return $sce.trustAsHtml;}]);geekApp.filter('trust_url',['$sce',function($sce){return $sce.trustAsResourceUrl;}]);geekApp.filter('partition',function(){return _.memoize(_.chunk,function(arr){return JSON.stringify(arr,function(key,value){if(key==='$$hashKey')
return undefined;else
return value;});});});geekApp.filter('currencyFromCode',['$filter','currencies',function($filter,currencies){return function(amount,currencyCode){var currency=_.find(currencies,{value:currencyCode});if(currency&&currency.symbol){return $filter('currency')(amount,currency.symbol);}else{return amount;}};}]);geekApp.filter('domainFromUrl',function(){return function(url){var domain;if(url.indexOf("://")>-1){domain=url.split('/')[2];}
else{domain=url.split('/')[0];}
domain=domain.split(':')[0];return domain;}});geekApp.filter('modulo',function(){return function(arr,div,val){if(!arr)
return;return arr.filter(function(item,index){return index%div===(val||0);})};});geekApp.filter('nohot',['geekitemSettings',function(geekitemSettings){return function(items){return items.filter(function(item){return(item.sort!='hot'||!geekitemSettings.overview_nohot);});};}]);geekApp.filter('humanizePriority',function(){return function(number){switch(number){case 1:return"Must Have";case 2:return"Interested";case 3:return"Undecided";case 4:return"Not Interested";default:return"N/A";}};});geekApp.filter('humanizeSort',function(){return function(sort){switch(sort){case'hot':return"Hot";case'priority':return"Priority";case'publisher':return"Publisher";case'title':return"Title";case'recent':return"Recently Added";case'rating':return"Rating";case'price_asc':return"Price (Low to High)";case'price_desc':return"Price (High to Low)";case'playtime_asc':return"Play Time (Low to High)";case'playtime_desc':return"Play Time (High to Low)";case'musthave':return"Must Have";case'interested':return"Interested";case'undecided':return"Undecided";case'location':return"Location";case'stats':return"Stats";case'specialcategory':return"Gift Guide Category";default:return"N/A";}};});geekApp.filter('capitalize',function(){return function(input,scope){if(input!=null)
input=input.toLowerCase();return input.substring(0,1).toUpperCase()+input.substring(1);}});geekApp.filter('youtubeEmbedUrl',function($sce){return function(videoId){return $sce.trustAsResourceUrl('https://www.youtube.com/embed/'+videoId);};});geekApp.filter('contains',function(){return function(array,needle){return array.indexOf(needle)>=0;};});
geekApp.directive('hotnessModule',function(){return{scope:{showcount:'@',objecttype:'@'},controller:'GeekOutput_HotnessCtrl',controllerAs:'hotctrl',bindToController:true,templateUrl:'geekoutput_module_hotness.tpl'}});geekApp.directive('recentlyviewedModule',['$http',function($http){return{scope:{disablelocation:'@'},controller:'GeekOutput_RecentCtrl',controllerAs:'recentctrl',bindToController:true,templateUrl:'geekoutput_recentlyviewed.tpl'}}]);geekApp.directive('geekoutputFooter',function(){return{templateUrl:'geekoutput_footer.tpl'};});geekApp.directive('geekoutputLegacyFooter',function(){return{templateUrl:'geekoutput_legacy_footer.tpl'};});geekApp.directive('geekoutputSidebar',['$localStorage',function($localStorage){return{link:function(scope){scope.$storage=$localStorage;},restrict:'E',templateUrl:'geekoutput_sidebar.tpl',controller:'GeekOutput_LayoutCtrl',controllerAs:'sidebarctrl',scope:{showOverlaySidebar:'=',deactivateOverlaySidebar:'='}}}]);geekApp.directive('showLoggedOut',['geekAccount',function(geekAccount){var link=function(scope,elements,attrs){elements.addClass('ng-hide');geekAccount.isLoggedIn.then(function(loggedIn){if(!loggedIn)
elements.removeClass('ng-hide');});};return{restrict:'A',link:link}}]);geekApp.directive('quickbar',[function(){return{templateUrl:'geekoutput_header_quickbar.tpl',replace:true,controller:'QuickBarCtrl',controllerAs:'quickbarctrl'}}]);geekApp.directive('quickbarLink',function(){return{templateUrl:'geekoutput_quickbar_link.html',replace:true,controller:'QuickbarLinkCtrl',controllerAs:'quickbarlinkctrl'};});geekApp.directive('microbadge',function(){return{restrict:'E',scope:{badge:'='},templateUrl:'microbadge.html'}});geekApp.directive('range',[function(){return{templateUrl:'rangetemplate.html',restrict:'E',link:function(scope){scope.sep=scope.sep||'–';},replace:true,scope:{'min':'=','max':'=','sep':'@'}}}]);geekApp.directive('persistentSelector',['$localStorage',function($localStorage){var link=function(scope){if(typeof scope.value==='undefined'){scope.value=$localStorage[scope.key]||scope.default;if(scope.callback&&scope.value!=0){scope.callback(scope.key,scope.value,true);}}
scope.$watch('value',function(value,oldValue){if(value===oldValue)
return;$localStorage[scope.key]=value;if(scope.callback){scope.callback(scope.key,value,false);}});};return{restrict:'E',scope:{key:'@',value:'=',options:'=',default:'@',callback:'='},link:link,templateUrl:function(tElement,tAttrs){return tAttrs.templateUrl;}};}]);
geekApp.controller('PleaController',['$cookies','$http','$timeout','$window','$location','geekAccount',function($cookies,$http,$timeout,$window,$location,geekAccount){var that=this;this.loading=true;this.$onInit=function(){$http.get('support/randomblurb').then(function(result){that.plea=result.data;that.plea.thermometer.widthStyle=Math.min(that.plea.thermometer.percentage,100.0).toString()+'%';that.showAppeal=!$cookies.get(that.plea.cookie_key);that.loading=false;});};geekAccount.getUserPromise.then(function(currentUser){that.username=currentUser.username?currentUser.username:'Anonynmous User';});this.amounts=[15,25,40,70,100];this.frequency=null;this.error=false;this.amount=25;this.otherAmount=null;this.domain=$location.host();this.cancelReturn=$location.absUrl();this.endOfYear=moment().tz("America/Chicago").endOf('year');this.daysLeft=this.endOfYear.diff(moment(),'days');this.toggleAppeal=function(){this.showAppeal=!this.showAppeal;if(this.showAppeal){$cookies.remove(this.plea.cookie_key,{path:'/',domain:this.plea.cookie_domain,});}
else{$cookies.put(this.plea.cookie_key,'1',{path:'/',domain:this.plea.cookie_domain,expires:moment().add(3,'days').toDate()});}};if(this.daysLeft>100){this.endOfYear.subtract(1,'years');}
this.updateAmount=function(){if(this.amount==="Other"&&this.amounts.includes(this.otherAmount)){this.amount=this.otherAmount;this.otherAmount=null;}else if(!this.amounts.includes(this.amount)){this.otherAmount=this.amount;this.amount="Other";}};this.submitPaypal=function(){if(!this.frequency){this.error=true;return;}
var form=document.getElementById('support-drive-form');form.submit();};this.payStripe=function(){if(this.amount==='Other')
amount=parseInt(this.otherAmount,10);else
amount=parseInt(this.amount,10);interval=this.getInterval(this.frequency);url='/support?supporttype=creditcard&amount='+amount;if(interval){url=url+'&interval='+interval;}
$window.location.href=url;};this.getInterval=function(frequency){switch(frequency){case'annual':return'year';case'monthly':return'month';case'onetime':return'onetime';default:return null;}};this.getFrequencyPrettyName=function(freq){if(freq==='annual')
return'Annual';else if(freq==='monthly')
return'Monthly';};}]);geekApp.component('geekoutputPlea',{templateUrl:'geekoutput_plea.tpl',controller:'PleaController'});
geekApp.factory('loginHttpTools',['$http',function($http){var loginTools={};loginTools.login=function(credentials){return $http.post('/login/api/v1',{credentials:credentials});};return loginTools;}]);geekApp.directive('loginRequired',['geekAccount','$uibModal',function(geekAccount,$modal){var login=function(){var modalInstance=$modal.open({templateUrl:'geeklogin_dialog.tpl',controller:'LoginDialogCtrl',size:'md'});};var showLoginAndStopEvent=function($event){$event.stopImmediatePropagation();$event.preventDefault();login();};var isLoggedIn=false;var showLoginIfLoggedOut=function($event){if(!isLoggedIn){showLoginAndStopEvent($event);}};var link=function(scope,elem){geekAccount.isLoggedIn.then(function(loggedIn){isLoggedIn=loggedIn;});elem.on('click',showLoginIfLoggedOut);};return{link:link,restrict:'A',priority:-10}}]);geekApp.controller('LoginDialogCtrl',['$scope','$uibModalInstance','loginHttpTools','$window',function($scope,$uibModalInstance,loginHttpTools,$window){$scope.credentials={};$scope.response={};$scope.$on('modal.closing',function(event,credentials,closing){if(closing){$scope.response.message='';event.preventDefault();loginHttpTools.login(credentials).then(function(){$window.location.reload();},function(response){$scope.response.message=response.data.errors.message;});}});}]);geekApp.directive('geekAuth2fa',[function(){return{restrict:'A',controller:'geek2FACtrl',controllerAs:'$authctrl',bindToController:true}}]);geekApp.controller('geek2FACtrl',['$http','$window',function($http,$window){var that=this;this.data={};this.verify2FA=function(){that.data.errors=null;$http.post('/api/login/verify2fa',this.data).then(function(response){$window.location.href='/geekadmin.php?action=adminlogin';},function errorCallback(response){console.log(response);that.data.errors=response.data.errors;});};}]);
geekApp.factory('geekAccount',['$http','userid','loadingTracker','$q',function($http,userid,loadingTracker,$q){var geekAccount={};geekAccount.user={};var getUser=loadingTracker.allLoaded().then(function(){if(userid){return $http.get('/api/users/current');}else{var deferUser=$q.defer();deferUser.resolve({data:{adblock:[],admin:[],avatar:false,firstname:null,lastname:null,loggedIn:false,tweetplays:false,userid:0,username:null}});return deferUser.promise;}});var defer=$q.defer();defer.resolve(!!userid);geekAccount.isLoggedIn=defer.promise;geekAccount.getUserPromise=getUser.then(function(response){geekAccount.user=response.data;return geekAccount.user;});geekAccount.admin=getUser.then(function(response){return response.data.admin;});return geekAccount;}]);geekApp.directive('showLoggedIn',['geekAccount',function(geekAccount){return{restrict:'A',transclude:'element',link:function(scope,element,attrs,ctrl,$transclude){geekAccount.isLoggedIn.then(function(response){if(response){$transclude(function(clone){element.after(clone);});}});}};}]);
geekApp.directive('geekAccountEdit2fa',[function(){return{restrict:'A',bindToController:true,controller:'geekAccountEdit2fa_Ctrl',controllerAs:'$geek2fa_editctrl'}}]);geekApp.controller('geekAccountEdit2fa_Ctrl',['$http','$uibModal','$window','$q',function($http,$modal,$window,$q){var that=this;that.data={};this.$onInit=function(){this.loading=true;var promises=[];promises.push($http.get("/api/accounts/2fa"));promises.push($http.get("/api/csrf/token"));$q.all(promises).then(function(results){_.forEach(results,function(result){that.data=_.merge(that.data,result.data);that.loading=false;});});};this.handleSubmit=function(){$http.post("/api/accounts/2fa",this.data).then(function(response){that.data.code='';that.data.errors='';$window.location.href="/geekaccount/edit";},function errorCallback(response){that.data.errors=response.data.errors;});};this.handleRemove=function(){var confirmer=$modal.open({controller:function($scope){$scope.confirmTitle="Confirm Removal";$scope.confirmBody="Are you sure you want to remove 2-Factor Authentication?";$scope.confirmDismiss="Cancel";$scope.confirmClose="Yes, Remove";},windowClass:'modal-confirm',size:'sm',templateUrl:'geekoutput_modal_confirm.tpl'});confirmer.result.then(function(){$http.delete("/api/accounts/2fa",{data:that.data}).then(function(response){$window.location.href="/geekaccount/edit";},function errorHandler(response){that.data.errors=response.data.errors;});});};}]);
geekApp.directive('geekAccountForgotPassword',[function(){return{restrict:'A',bindToController:true,controller:'geekAccountForgot_Ctrl',controllerAs:'$ctrl',link:function(scope,element,attrs){scope.$ctrl.url='/api/accounts/forgotpassword';}}}]);geekApp.directive('geekAccountForgotUsername',[function(){return{restrict:'A',bindToController:true,controller:'geekAccountForgot_Ctrl',controllerAs:'$ctrl',link:function(scope,element,attrs){scope.$ctrl.url='/api/accounts/forgotusername';}}}]);geekApp.controller('geekAccountForgot_Ctrl',['$http',function($http){this.data={};this.handleSubmit=function(){var that=this;this.saving=true;$http.post(this.url,this.data).then(function(response){that.saving=false;that.success=true;that.data.message=response.data.message;},function errorCallback(response){that.saving=false;that.error=response.data;});};}]);
geekApp.directive('geekAccountResetPassword',[function(){return{restrict:'A',bindToController:true,controller:'geekAccountResetPassword_Ctrl',controllerAs:'$ctrl'}}]);geekApp.controller('geekAccountResetPassword_Ctrl',['$http','$location',function($http,$location){this.data={};this.handleSubmit=function(){var that=this;this.saving=true;$http.post('/api/accounts/resetpassword',this.data).then(function(response){that.saving=false;that.success=true;that.data.message=response.data.message;},function errorCallback(response){that.saving=false;that.error=response.data;});};}]);
geekApp.factory('geekAdmin',['$http',function($http){var geekAdmin={};geekAdmin.checkAccess=function(accesslist,objecttype,objectid){var url='/api/admins';var params={'accesslist[]':accesslist,objecttype:objecttype,objectid:objectid};return $http.get(url,{params:params,cache:true}).then(function(response){return response.data.status;});};return geekAdmin;}]);geekApp.directive('showAccess',['geekAdmin','geekAccount',function(geekAdmin,geekAccount){return{restrict:'A',multiElement:true,link:function(scope,elements,attrs){if(!attrs.showAccess){return;}
elements.addClass('ng-hide');geekAccount.admin.then(function(admin){if(admin&&admin.any)
return checkAccess();});var checkAccess=function(){var accessList=((typeof attrs.showAccess)==='string')?_.words(attrs.showAccess,/[^|]+/g):attrs.showAccess;geekAdmin.checkAccess(accessList,attrs.accessObjecttype,attrs.accessObjectid).then(function(status){if(_.some(status))
elements.removeClass('ng-hide');});};}}}]);
geekApp.directive('playRecorderButton',['$uibModal',function($modal){var link=function(scope,elem,atrr){var eventAdded=false;var activateRecorder=function(){if(itemIsSet()&&!eventAdded){eventAdded=true;elem.on('click',function(){scope.play={};$modal.open({'controller':'RecordPlayController','scope':scope,confirmOnDismiss:true,'windowClass':'modal-record-play modal-fixed-right','templateUrl':"geekitem_dialog_recordplay.tpl"});});}};var itemIsSet=function(){return scope.item&&scope.item.objectid&&scope.item.objecttype;};scope.$watch('item',activateRecorder);};return{link:link,restrict:'A',scope:{'item':'='}}}]);geekApp.directive('playDeleteButton',['$uibModal','playHttpTools','$rootScope',function($modal,playHttpTools,$rootScope){var link=function(scope,elem){elem.on('click',function(){scope.confirmTitle="Confirm Deletion";scope.confirmBody="Are you sure you want to delete this play?";scope.confirmDismiss="Cancel";scope.confirmClose="Yes, Delete";var confirmer=$modal.open({scope:scope,windowClass:'modal-confirm',size:'sm',templateUrl:'geekoutput_modal_confirm.tpl'});confirmer.result.then(function(){scope.play.deleted=true;var playCountChange=-1*scope.play.quantity;playHttpTools.delete(scope.play.playid).then(function(){$rootScope.$broadcast('playsUpdated',playCountChange);});});});};return{link:link,restrict:'A',scope:{play:'='}}}]);geekApp.factory('playHttpTools',['$http','$q','$sessionStorage','geekAccount',function($http,$q,$sessionStorage,geekAccount){var useCache=true;var playTools={};var playStats={};var persistDataInSessionStorage=function(data){$sessionStorage.playData=$sessionStorage.playData?$sessionStorage.playData:{recentLocations:[],recentPlayers:[]};$sessionStorage.playData.lastPlay={date:data.date.valueOf()};if(data.location){$sessionStorage.playData.lastPlay.location=data.location;$sessionStorage.playData.recentLocations.push(data.location);$sessionStorage.playData.recentLocations=_.uniq($sessionStorage.playData.recentLocations);}
if(data.players.length){var players=_.map(data.players,function(player){return _.pick(player,['avatar','avatarfile','name','userid','username']);});$sessionStorage.playData.lastPlay.players=players;var recentPlayers=players.concat($sessionStorage.playData.recentPlayers);$sessionStorage.playData.recentPlayers=_.uniq(recentPlayers,function(player){return player.name+'|'+player.userid;});}};playTools.getLastPlayData=function(){if($sessionStorage.playData&&$sessionStorage.playData.lastPlay){return{date:new Date($sessionStorage.playData.lastPlay.date),players:_.map($sessionStorage.playData.lastPlay.players,_.clone),location:$sessionStorage.playData.lastPlay.location}};};playTools.save=function(data){useCache=false;persistDataInSessionStorage(data);data.ajax=1;data.action='save';return $http.post('/geekplay.php',data);};playTools.delete=function(playid){useCache=false;var data={playid:playid,ajax:1,finalize:1,action:'delete'};return $http.post('/geekplay.php',data);};var addRecentLocations=function(response){response=Array.isArray(response.locations)?response:{'locations':[]};var recentLocations=_.get($sessionStorage,'playData.recentLocations');if(Array.isArray(recentLocations)){_.forEach(recentLocations,function(location){response.locations.unshift({'location':location});});response.locations=_.uniq(response.locations,'location');}
return response;};var addRecentPlayers=function(response){response=Array.isArray(response)?response:[];var recentPlayers=_.map(_.get($sessionStorage,'playData.recentPlayers'),_.clone);if(Array.isArray(recentPlayers)){response=_.uniq(recentPlayers.concat(response),function(player){return player.name+'|'+player.userid;});}
return response;};playTools.getLocations=function(){return $http.get('/geekplay.php',{params:{ajax:1,action:'locations'},transformResponse:appendTransform($http.defaults.transformResponse,addRecentLocations)});};var getUsersCanceller=null;playTools.getUsers=function(searchterm){if(getUsersCanceller){getUsersCanceller.resolve();}
getUsersCanceller=$q.defer();var getObj={'params':{ajax:1,action:'searchplayersandusers',showcount:10,q:searchterm},timeout:getUsersCanceller.promise};if(!searchterm){getObj.transformResponse=appendTransform($http.defaults.transformResponse,addRecentPlayers);}
return $http.get('geekplay.php',getObj);};var appendTransform=function(defaults,transform){defaults=angular.isArray(defaults)?defaults:[defaults];return defaults.concat(transform);};playTools.getUserPlayCount=function(item){return geekAccount.isLoggedIn.then(function(loggedIn){if(loggedIn){return $http.get('/geekplay.php',{'params':{ajax:1,action:'getuserplaycount',objecttype:item.objecttype,objectid:item.objectid},cache:useCache});}
else{var defer=$q.defer();defer.resolve({data:{count:null,userid:null}});return defer.promise;}});};playTools.getUserPlayInfo=function(item){return geekAccount.isLoggedIn.then(function(loggedIn){if(loggedIn){return $http.get('/geekplay.php',{'params':{ajax:1,action:'getplays',showcount:item.showcount?item.showcount:10,pageID:item.pageid?item.pageid:1,currentUser:true,objecttype:item.objecttype,objectid:item.objectid},cache:useCache});}
else{var defer=$q.defer();defer.resolve({data:{eventcount:"0",plays:[],userid:null}});return defer.promise;}});};return playTools;}]);geekApp.controller('RecordPlayController',['$scope','$uibModalInstance','$filter','playHttpTools','notify','$uibModal','$rootScope','geekAccount',function($scope,$uibModalInstance,$filter,playHttpTools,notify,$modal,$rootScope,geekAccount){$scope.play.players=[];$scope.play.quantity=1;$scope.playstats={};$scope.currentUserIsInPlayers=false;$scope.userSearchResults=[];$scope.usersLoading=false;$scope.viewVars={showAdvanced:false,recordScreen:'main'};geekAccount.getUserPromise.then(function(user){$scope.viewVars.user=user;$scope.play.twitter=user.tweetplays;});$scope.intervals=[{minutes:30,label:'30 m'},{minutes:60,label:'1 h'},{minutes:90,label:'1.5 h'},{minutes:120,label:'2 h'},{minutes:150,label:'2.5 h'},{minutes:180,label:'3 h'}];playHttpTools.getUserPlayCount($scope.item).then(function(result){$scope.playstats.count=result.data.count;$scope.playstats.userid=result.data.userid;});var today=new Date();today.setHours(0,0,0,0);$scope.play.date=new Date(today.valueOf());var yesterday=new Date();yesterday.setDate(today.getDate()-1);yesterday.setHours(0,0,0,0);$scope.today=today;$scope.yesterday=yesterday;$scope.maxDate=today;var baseHourOptions=_.range(0,24);var baseMinuteOptions=_.range(0,51,10);$scope.hourOptions=baseHourOptions;$scope.minuteOptions=baseMinuteOptions;var originalLocations=[];var unchangedPlay=angular.copy($scope.play);var dataIsUnchanged=function(){return angular.equals($scope.play,unchangedPlay);};$uibModalInstance.setBypassConfirmCallback(dataIsUnchanged);$scope.addDaysToDate=function(days){$scope.play.date.setDate($scope.play.date.getDate()+days);};playHttpTools.getLocations().then(function(response){originalLocations=angular.copy(response.data.locations);$scope.locations=response.data.locations;});$scope.lastPlay=playHttpTools.getLastPlayData();$scope.loadFromLastPlay=function(){$scope.play.date=new Date($scope.lastPlay.date.valueOf());$scope.play.location=$scope.lastPlay.location;_.forEach($scope.lastPlay.players,function(player){$scope.addPlayer(player);});if($scope.lastPlay.players.length||$scope.lastPlay.location)
$scope.viewVars.showAdvanced=true;$scope.lastPlay=null;};$scope.togglePlayer=function(user){if(userInPlayers(user,$scope.play.players)){$scope.deletePlayer(user);}
else{$scope.play.players.push(_.clone(user));activateAddPlayer();}
markPlayersSelectedInSearchResults();};var userInPlayers=function(user,players){return _.some(players,function(player){return userMatchesPlayer(user,player);});};$scope.addPlayer=function(user){if(!userInPlayers(user,$scope.play.players)){$scope.play.players.push(_.clone(user));markPlayersSelectedInSearchResults();}};var activateAddPlayer=function(){if($scope.play.userfilter){$scope.play.userfilter='';$scope.$broadcast('AddPlayerFocus');}};$scope.makeNonUserPlayer=function(name){return{name:name,username:'',disambiguator:Math.random()};};$scope.setRecordScreen=function(screenname){$scope.viewVars.recordScreen=screenname;};$scope.refreshHours=function(value,$select){$scope.hourOptions=angular.copy(baseHourOptions);if(value){$scope.hourOptions.unshift(value);$select.activeIndex=0;}};$scope.refreshMinutes=function(value,$select){$scope.minuteOptions=angular.copy(baseMinuteOptions);if(value){$scope.minuteOptions.unshift(value);$select.activeIndex=0;}};var userMatchesPlayer=function(user,player){if(!user.userid&&!player.userid){return user.name==player.name;}
else
return user.userid==player.userid&&user.name==player.name;};var markPlayersSelectedInSearchResults=function(){_.forEach($scope.userSearchResults,function(user){user.selected=false;});_.forEach($scope.play.players,function(player){_.forEach($scope.userSearchResults,function(user){if(userMatchesPlayer(user,player)){user.selected=true;}});});};var refreshUserSearch=function(value){$scope.usersLoading=true;return playHttpTools.getUsers(value).then(function(response){$scope.usersLoading=false;$scope.userSearchResults=response.data;var repeatPlayerWithMatchingUsernameInArray=function(users,search){return typeof _.find(users,function(user){return user.repeat&&user.username.toLowerCase()===search.toLowerCase();})!=='undefined';};var nonUserPlayerWithMatchingNameInArray=function(users,search){return typeof _.find(users,function(user){return!user.userid&&user.name===search;})!=='undefined';};if(value){if(repeatPlayerWithMatchingUsernameInArray($scope.userSearchResults,value)){$scope.userSearchResults.push($scope.makeNonUserPlayer(value));}
else
if(!nonUserPlayerWithMatchingNameInArray($scope.userSearchResults,value)){$scope.userSearchResults.unshift($scope.makeNonUserPlayer(value));}
markPlayersSelectedInSearchResults();}
else{geekAccount.getUserPromise.then(function(currentUser){_.remove($scope.userSearchResults,function(user){return user.userid==currentUser.userid;});$scope.userSearchResults.unshift({'name':currentUser.firstname+' '+currentUser.lastname,'username':currentUser.username,'userid':currentUser.userid,'avatarfile':currentUser.avatarfile,'avatar':currentUser.avatar});markPlayersSelectedInSearchResults();});}});};var deleteUseFromUserList=function(userList,user){return _.remove(userList,function(aUser){if(user.userid){return user.userid==aUser.userid&&user.name==aUser.name;}else{return user.name==aUser.name;}});};$scope.deletePlayer=function(user){deleteUseFromUserList($scope.play.players,user);};$scope.toggleDate=function($event){$event.preventDefault();$event.stopPropagation();$scope.dateopened=!$scope.dateopened;};$scope.updateDate=function(date){$scope.play.date=new Date(date.valueOf());};$scope.$watch('play.date',function(){$scope.dateopened=false;});$scope.increment=function(value,inc){return Math.max(1,value+inc);};$scope.dateInDefaults=function(date){if(!date)
return false;return $scope.dates.reduce(function(prev,current){return prev||current.valueOf()==date.valueOf();},false);};$scope.cancel=function(){$uibModalInstance.dismiss();};var refreshLocations=function(value){$scope.locations=angular.copy(originalLocations);if(value&&!_.some($scope.locations,function(location){return location.location==value;})){$scope.locations.unshift($scope.makeLocation(value));}};$scope.makeLocation=function(locationName){return locationName?{'location':locationName,'new':true}:null;};$scope.setLocation=function(location){$scope.play.location=location;$scope.setRecordScreen('main');$scope.play.locationfilter='';};$scope.setTime=function(minutes){$scope.play.minutes=minutes;$scope.play.hours=0;$scope.viewVars.showOtherTime=false;};$scope.$watch('play.locationfilter',function(locationfilter){refreshLocations(locationfilter);});$scope.$watch('play.userfilter',function(userfilter){refreshUserSearch(userfilter);});$scope.twitterRedirectModal=function(url){var scope=$rootScope.$new(true);scope.url=url;$modal.open({scope:scope,windowClass:'modal-record-play',templateUrl:'geekitem_dialog_linktwitter.tpl'});};$scope.setTime=function(minutes){$scope.play.minutes=minutes;$scope.play.hours=0;$scope.showOtherTime=false;};var getMinutes=function(){return(Number($scope.play.minutes)||0)+60*(Number($scope.play.hours)||0);};$scope.save=function(){$scope.saving=true;if($scope.play.savetwitterpref)
$scope.viewVars.user.tweetplays=$scope.play.twitter;var data=$scope.play;data.objecttype=$scope.item.objecttype;data.objectid=$scope.item.objectid;data.playdate=$filter('date')(data.date,'yyyy-MM-dd');data.length=getMinutes();playHttpTools.save(data).then(function(response){$uibModalInstance.close();if(response.data.url)
$scope.twitterRedirectModal(response.data.url);$rootScope.$broadcast('playsUpdated',data.quantity);notify({messageTemplate:"<span>Play logged - <a ui-sref='geekitem.mygames.plays'>View Plays</a></span>"});});};}]);geekApp.controller('GeekItem_PlayCtrl',['geekitemParams','playHttpTools','$scope',function(geekitemParams,playHttpTools,$scope){var that=this;this.playstats={};this.params={objecttype:geekitemParams.objecttype,objectid:geekitemParams.objectid,pageid:1,showcount:10};$scope.$on('playsUpdated',function(){that.loadPage();});this.loadPage=function(){playHttpTools.getUserPlayInfo(that.params).then(function(result){that.playstats=result.data;});};this.loadPage();}]);geekApp.directive('playerList',function(){return{restrict:'E',templateUrl:'geekplay_playerlist.tpl',scope:{players:'=players'}};});
geekApp.factory('subscriptionHttpTools',['$http','loadingTracker','geekAPIUrls','geekAccount','$q','$window',function($http,loadingTracker,geekAPIUrls,geekAccount,$q,$window){var subscriptionTools={};getNewEventCountPromise=function(){return loadingTracker.allLoaded().then(function(){return geekAccount.isLoggedIn.then(function(loggedIn){if(loggedIn){return $http.get('/geeksubscription.php',{'params':{'ajax':1,'action':'geteventcount'}});}
else{var defer=$q.defer();defer.resolve({data:{count:null}});return defer.promise;}});});};subscriptionTools.getEventCount=getNewEventCountPromise();angular.element($window).on('focus',function(){subscriptionTools.getEventCount=getNewEventCountPromise();});subscriptionTools.getSubInfoByObject=function(item){return geekAccount.isLoggedIn.then(function(loggedIn){if(loggedIn){return $http.get('/geeksubscription.php',{'params':{'objecttype':item.objecttype,'objectid':item.objectid,'ajax':1,'action':'getsubinfobyitem'},cache:true});}
else{var defer=$q.defer();defer.resolve({data:{subbed:false}});return defer.promise;}});};subscriptionTools.getSubCountByObject=function(item){var url=geekAPIUrls.subscriptions;return $http.get(url+"/count",{'params':{'objecttype':item.objecttype,'objectid':item.objectid},cache:true});};subscriptionTools.checkBlock=function(item){return $http.get('/geeksubscription.php',{'params':{'objecttype':item.objecttype,'objectid':item.objectid,'ajax':1,'action':'checkblock'},cache:true});};var postSub=function(item,subaction,exclude){return $http.post('/geeksubscription.php',{'objecttype':item.objecttype,'objectid':item.objectid,'ajax':1,'action':'subscribe','exclude':exclude,'subaction':subaction});};subscriptionTools.subscribe=function(item){return postSub(item,'subscribe',0);};subscriptionTools.unsubscribe=function(item){return postSub(item,'unsubscribe',0);};subscriptionTools.block=function(item){return postSub(item,'subscribe',1);};subscriptionTools.unblock=function(item){return postSub(item,'unsubscribe',1);};return subscriptionTools;}]);geekApp.directive('subscription',['subscriptionHttpTools','$q',function(subscriptionHttpTools,$q){var link=function(scope,element,attrs){scope.status={'isOpen':false};scope.btnGroupClasses={};if(scope.mobile)
scope.btnGroupClasses['btn-group-mobile']=true;scope.displayCount='displayCount'in attrs;scope.displayCountClass=attrs.displayCountClass;scope.subscribemouseover=false;scope.btnSize=scope.btnSize?scope.btnSize:'sm';scope.btnGroupClasses['btn-group-'+scope.btnSize]=true;scope.btnStyle=scope.btnStyle?scope.btnStyle:'white';var updateSubscription=function(){if(scope.itemIsSet()){var subInfoPromise=subscriptionHttpTools.getSubInfoByObject(scope.item).then(function(response){scope.subbed=response.data.subbed;});var subCountPromise=subscriptionHttpTools.getSubCountByObject(scope.item).then(function(response){scope.subcount=response.data.subcount;});$q.all([subInfoPromise,subCountPromise]).then(function(){scope.subIsLoaded=true;});}};scope.subscribe=function(){subscriptionHttpTools.subscribe(scope.item).then(function(){scope.subbed=true;scope.subcount+=1;});};scope.unsubscribe=function(){subscriptionHttpTools.unsubscribe(scope.item).then(function(){scope.subbed=false;scope.subcount-=1;});};scope.block=function(){subscriptionHttpTools.block(scope.item).then(function(){scope.blocked=true;});};scope.unblock=function(){subscriptionHttpTools.unblock(scope.item).then(function(){scope.blocked=false;});};scope.itemIsSet=function(){return scope.item&&scope.item.objectid&&scope.item.objecttype;};scope.blockLoaded=false;var updateBlock=function(open){if(open&&!scope.blockLoaded){subscriptionHttpTools.checkBlock(scope.item).then(function(result){scope.blocked=result.data.blocked;scope.blockLoaded=true;});}};scope.$watch('item',updateSubscription);scope.$watch('status.isOpen',updateBlock);};return{templateUrl:'geekitem_template_subscriptions_dropdown.tpl',link:link,restrict:'E',scope:{'item':'=','btnSize':'@','btnStyle':'@','mobile':'='}};}]);geekApp.controller('SubCountCtrl',['subscriptionHttpTools','$window',function(subscriptionHttpTools,$window){var that=this;var refreshSubscriptionCount=function(){subscriptionHttpTools.getEventCount.then(function(response){that.eventcount=response.data.count;});};angular.element($window).on('focus',refreshSubscriptionCount);refreshSubscriptionCount();}]);geekApp.directive('subscriptionNotifications',function(){return{controller:'SubCountCtrl',controllerAs:'subcountctrl',bindToController:true,templateUrl:'geekoutput_notifications_subscriptions.tpl'}});
geekApp.factory('amazonHttpTools',['$http','loadingTracker','geekAPIUrls','userid',function($http,loadingTracker,geekAPIUrls,userid){var amazonTools={};amazonTools.getLocale=function(){return loadingTracker.allLoaded().then(function(){var params={};if(userid){params.userid=userid;}
return $http.get('/api/amazon/locale',{params:params,cache:true});})}
amazonTools.getTextAd=function(objecttype,objectid,locale){return loadingTracker.allLoaded().then(function(){return $http.get(geekAPIUrls.amazon+'/textads',{'params':{objecttype:objecttype,objectid:objectid,locale:locale},cache:true});});};amazonTools.getItemURLs=function(objecttype,objectid,locale){return loadingTracker.allLoaded().then(function(){return $http.get(geekAPIUrls.amazon+'/itemurls',{'params':{objecttype:objecttype,objectid:objectid,locale:locale},cache:true});});};return amazonTools;}]);geekApp.controller('AmazonAdCtrl',['amazonHttpTools',function(amazonHttpTools){var that=this;amazonHttpTools.getLocale().then(function(localeResult){var locale;if(!localeResult||!localeResult.data){locale='us';}else{locale=localeResult.data;}
amazonHttpTools.getItemURLs(that.objecttype,that.objectid,locale).then(function(result){if(result.data){that.url=result.data[locale];}});});}]);geekApp.directive('amazonad',[function(){return{restrict:'E',scope:{objecttype:'=',objectid:'='},templateUrl:'amazonad.html',controller:'AmazonAdCtrl',controllerAs:'amazonadctrl',bindToController:true};}]);geekApp.controller('AmazonTextAdCtrl',['amazonHttpTools',function(amazonHttpTools){var that=this;amazonHttpTools.getLocale().then(function(localeResult){var locale;if(!localeResult||!localeResult.data){locale='us';}else{locale=localeResult.data;}
amazonHttpTools.getTextAd(that.objecttype,that.objectid,locale).then(function(result){if(result.data){that.data=result.data[locale];}});});}]);geekApp.directive('amazonTextAd',[function(){return{restrict:'E',scope:{objecttype:'=',objectid:'='},templateUrl:function(tElement,tAttrs){if(tAttrs.type=='listprice')
return'amazon_listprice_li.tpl';else
return'amazon_text_ad.tpl'},controller:'AmazonTextAdCtrl',controllerAs:'amazonadctrl',replace:true,bindToController:true};}]);
geekApp.directive('addTag',function(){return{restrict:'A',replace:true,controller:'GeekItem_AddTagCtrl',controllerAs:'addtagctrl',bindToController:true}});geekApp.factory('tagHttpTools',['$http','loadingTracker',function($http,loadingTracker){var tagTools={};tagTools.save=function(data){return loadingTracker.addPromise($http.post('/api/tags',data));};tagTools.unpinTag=function(pinid){return loadingTracker.addPromise($http.delete('/api/pins/'+pinid));};tagTools.getTags=function(params){return loadingTracker.addPromise($http.get('/api/tags',{params:params}));};tagTools.getSuggestedTags=function(params){if(params)
params.suggested=1;else
params={suggested:1};return loadingTracker.addPromise($http.get('/api/tags',{params:params}));};return tagTools;}]);geekApp.factory('tagData',['tagHttpTools',function(tagHttpTools){var tagdata={globaltags:null,mytags:null};tagdata.getTags=function(params){tagHttpTools.getTags(params).then(function(response){tagdata.data=response.data;})};tagdata.unpinTag=function(pinid){return tagHttpTools.unpinTag(pinid);};tagdata.saveTag=function(data){return tagHttpTools.save(data);};return tagdata;}]);geekApp.controller('GeekTag_ModuleCtrl',['tagData',function(tagData){var that=this;this.tagData=tagData;this.$onInit=function(){this.getTags();};this.getTags=function(){var params={objecttype:this.params.objecttype,objectid:this.params.objectid};tagData.getTags(params);};this.saveTag=function(tag){var params={objecttype:this.params.objecttype,objectid:this.params.objectid,newtags:tag.rawtag};tagData.saveTag(params).then(function(){that.getTags()});};this.unpinTag=function(tag){tagData.unpinTag(tag.pinid).then(function(){that.getTags();});};}]);geekApp.controller('GeekItem_AddTagCtrl',['$uibModal','tagData',function($modal,tagData){var that=this;this.popupAddTag=function(objecttype,objectid){var modalInstance=$modal.open({templateUrl:'geekitem_dialog_addtag.tpl',controller:'AddTagModalCtrl',controllerAs:'tagmodalctrl',windowClass:'modal-fixed-right',resolve:{'geekobject':function(){return{'objecttype':objecttype,'objectid':objectid}}}});modalInstance.result.then(function(){tagData.getTags({'objecttype':objecttype,'objectid':objectid})},function(){});};}]);geekApp.controller('AddTagModalCtrl',['$scope','$uibModalInstance','geekobject','tagHttpTools','notify',function($scope,$uibModalInstance,geekobject,tagHttpTools,notify){var that=this;this.geekobject=geekobject;this.getSuggestedTags=function(){tagHttpTools.getSuggestedTags().then(function(response){that.suggestedtags=response.data.suggestedtags;});};this.cancel=function(){$uibModalInstance.close();};this.save=function(){var data=this.tagdata;data.objecttype=geekobject.objecttype;data.objectid=geekobject.objectid;tagHttpTools.save(data).then(function(response){$uibModalInstance.close();notify("Tags saved");});};this.getSuggestedTags();}]);
geekApp.factory('imageHttpTools',['$http','loadingTracker','geekAPIUrls',function($http,loadingTracker,geekAPIUrls){var imgTools={};imgTools.getImages=function(params){var url=geekAPIUrls.images;var getParams=angular.copy(params);getParams.nosession=1;return loadingTracker.addPromise($http.get(url,{params:getParams,cache:true}));};imgTools.saveImageLink=function(params){return $http.post('/api/imagelinks',params);};imgTools.removeImageLink=function(params){return $http.delete('/api/imagelinks',{params:params});};return imgTools;}]);
geekApp.directive('addNote',function(){return{restrict:'A',replace:true,controller:'GeekItem_AddNoteCtrl',controllerAs:'addnotectrl',bindToController:true}});geekApp.factory('adminNotesHttpTools',['$http',function($http){var noteTools={};noteTools.getNotes=function(params){return $http.get('/api/adminnotes',{'params':params});};noteTools.save=function(data){return $http.post('/api/adminnotes',data);};noteTools.delete=function(noteid){return $http.delete('/api/adminnotes/'+noteid);};return noteTools;}]);geekApp.factory('noteData',['adminNotesHttpTools',function(adminNotesHttpTools){var notedata={};notedata.getNotes=function(params){adminNotesHttpTools.getNotes(params).then(function(response){notedata.data=response.data;})};notedata.saveNote=function(data){return adminNotesHttpTools.save(data);};notedata.deleteNote=function(noteid){return adminNotesHttpTools.delete(noteid);};return notedata;}]);geekApp.controller('GeekItem_AdminNotesCtrl',['geekitem','geekitemParams','noteData','$uibModal','$localStorage',function(geekitem,geekitemParams,noteData,$modal,$localStorage){var that=this;var giparams=angular.copy(geekitemParams);this.notedata=noteData;this.geekitem=new geekitem(giparams);this.$storage=$localStorage;this.getItems=function(){this.geekitem.getItem().then(function(){that.note_params={objecttype:geekitemParams.objecttype,objectid:geekitemParams.objectid,note_objecttype:'geekitem',note_objectid:that.geekitem.data.item.itemid};that.notedata.getNotes(that.note_params);});};this.deleteNote=function(note){var mi=$modal.open({templateUrl:'geekitem_dialog_confirm.tpl'});mi.result.then(function(){that.notedata.deleteNote(note.noteid).then(function(){that.notedata.getNotes(that.note_params);});},function(){});};this.getItems();}]);geekApp.controller('GeekItem_AddNoteCtrl',['$uibModal','noteData',function($modal,noteData){var that=this;this.popupAddNote=function(note_params,note){var modalInstance=$modal.open({templateUrl:'geekitem_dialog_addnote.tpl',controller:'AddNoteModalCtrl',resolve:{note_params:function(){return note_params;},note:function(){return note;}}});modalInstance.result.then(function(){noteData.getNotes(note_params);},function(){});};}]);geekApp.controller('AddNoteModalCtrl',['$scope','$uibModalInstance','noteData','note_params','note','notify',function($scope,$uibModalInstance,noteData,note_params,note,notify){$scope.newnote={adminnote:null};if(note){$scope.newnote.adminnote='[q]'+note.note+'[/q]';note_params.adminquestion=1;}
$scope.cancel=function(){$uibModalInstance.close();};$scope.save=function(){var data=note_params;data.adminnote=$scope.newnote.adminnote;noteData.saveNote(data).then(function(response){$uibModalInstance.close();notify("Note saved");},function(response){$uibModalInstance.close();notify({message:'Error saving note: '+response.data.message,classes:'alert-danger'});});};}]);
geekApp.factory('geekmodHttpTools',['$http','loadingTracker',function($http,loadingTracker){var geekmodTools={};geekmodTools.validateProposal=function(params){return loadingTracker.addPromise($http.get('/api/geekmod/validateproposal',{params:params}));};geekmodTools.saveProposal=function(params){return loadingTracker.addPromise($http.post('/api/geekmod/proposals',params));};return geekmodTools;}]);geekApp.directive('geekmodPropose',function(){return{restrict:'A',controller:'GeekItem_GeekModCtrl',controllerAs:'geekmodctrl',bindToController:true}});geekApp.controller('GeekItem_GeekModCtrl',['$attrs','geekitemParams','geekmodHttpTools','prompt','notify',function($attrs,geekitemParams,geekmodHttpTools,prompt,notify){var that=this;this.proposeRep=function(item){params={fieldname:$attrs.fieldname,modtype:'datafield',objecttype:geekitemParams.objecttype,objectid:geekitemParams.objectid,assoc_objecttype:item.objecttype,value:item.objectid};geekmodHttpTools.validateProposal(params).then(function(response){if(response.data.valid){prompt({title:'Propose Representative',message:'Note to Mods',input:true}).then(function(note){params.note=note;geekmodHttpTools.saveProposal(params).then(function(response){notify(response.data.message);},function error(response){notify({message:response.data.error,classes:'alert-danger'});});});}else{notify({message:response.data.error,classes:'alert-danger'});}});}}]);
geekApp.factory('mailHttpTools',['$http','loadingTracker','geekAccount','$q',function($http,loadingTracker,geekAccount,$q){var mailHttpTools={};mailHttpTools.getNumUnread=loadingTracker.allLoaded().then(function(){return geekAccount.isLoggedIn.then(function(loggedIn){if(loggedIn){return $http.get('/api/geekmail/messages',{'params':{metaonly:1,numunread:1}});}
else{var defer=$q.defer();defer.resolve({data:{numunread:"0"}});return defer.promise;}});});return mailHttpTools;}]);geekApp.controller('MailCountCtrl',['mailHttpTools','$scope',function(mailHttpTools,$scope){var that=this;$scope.$on('updateMailCount',function(event,args){that.numunread=args.numMessages;});mailHttpTools.getNumUnread.then(function(response){that.numunread=response.data.numunread;});}]);geekApp.directive('geekmailNotifications',function(){return{controller:'MailCountCtrl',controllerAs:'mailcountctrl',bindToController:true,templateUrl:'geekoutput_notifications_geekmail.tpl'}});
geekApp.factory('geekRecommendHttpTools',['$http',function($http){var tools={};tools.getRecommendInfo=function(params){return $http.get('/api/geekrecommend/info',{params:params});};return tools;}]);geekApp.controller('GeekRecommendCtrl',['geekRecommendHttpTools',function(geekRecommendHttpTools){var that=this;this.getRecommendInfo=function(){var params={itemtype:this.itemtype,itemid:this.itemid};that.loading=true;geekRecommendHttpTools.getRecommendInfo(params).then(function(response){that.data=response.data;that.loading=false;});};this.getRecommendInfo();}]);geekApp.directive('geekRecommendButton',[function(){return{restrict:'E',controller:'GeekRecommendCtrl',controllerAs:'geekrecctrl',bindToController:true,scope:{itemtype:'=',itemid:'='},templateUrl:'geekrecommend_button.tpl'}}]);
geekApp.factory('geekImageSelector',['$uibModal','$q',function($modal,$q){return function(options){var defaults={title:'Select Image',message:'',objecttype:'',objectid:'',buttons:[{label:'Cancel',cancel:true},{label:'OK',primary:true}]};if(options===undefined){options={};}
for(var key in defaults){if(options[key]===undefined){options[key]=defaults[key];}}
var defer=$q.defer();$modal.open({templateUrl:'geekitem_dialog_imageselector.tpl',controller:'GeekImageSelector_Ctrl',resolve:{options:function(){return options;}}}).result.then(function(result){defer.resolve(result);},function(){defer.reject();});return defer.promise;};}]);geekApp.controller('GeekImageSelector_Ctrl',['$scope','$uibModalInstance','imageHttpTools','options',function($scope,$uibModalInstance,imageHttpTools,options){$scope.params={pageid:1,showcount:50,size:'micro',objecttype:options.objecttype,objectid:options.objectid,sort:'recent'};$scope.options=options;$scope.selected=null;$scope.save=function(){$uibModalInstance.close($scope.selected);};$scope.cancel=function(){$uibModalInstance.dismiss();}
$scope.selectImage=function(image){$scope.selected=image;};$scope.getImages=function(){var params=angular.copy($scope.params);imageHttpTools.getImages(params).then(function(response){$scope.data=response.data;})};$scope.pageChanged=function(){$scope.getImages();};$scope.setParam=function(key,value){$scope.params[key]=value;$scope.getImages();};$scope.getImages();}]);
geekApp.directive('gkExpandable',[function(){return{restrict:'A',scope:{'maxHeight':'@expandableHeight','id':'@gkExpandable'},transclude:true,templateUrl:'geekExpandable.html',controller:'GeekExpandableController',controllerAs:'expandablectrl',bindToController:true}}]);geekApp.factory('geekExpandableService',function(){var data={};return data;});geekApp.controller('GeekExpandableController',['$element','$scope','$animate','geekExpandableService',function($element,$scope,$animate,geekExpandableService){var that=this;var isOpen=function(){return $element.hasClass('open');};this.$onInit=function(){that.heightThreshold=parseInt(that.maxHeight)+20;$element.addClass('expandable');if(that.expanded){$element.addClass('full');}
else{var body=$element[0].getElementsByClassName('expandable-body')[0];if(that.id!==''&&geekExpandableService[that.id])
$element.addClass('open');$scope.$watch(function(){return body.clientHeight;},function(newValue){if(!isOpen()&&newValue<that.heightThreshold){$element.addClass('full');}
else{$element.removeClass('full');}});}};that.open=function($event){$event.stopPropagation();if(that.id!=='')
geekExpandableService[that.id]=true;$animate.addClass($element,'open');};that.close=function($event){$event.stopPropagation();if(that.id!=='')
geekExpandableService[that.id]=false;$animate.removeClass($element,'open');};}]);
geekApp.controller('userImageUploaderCtrl',['FileUploader','geekimageSettings',function(FileUploader,geekimageSettings){var that=this;that.geekimageSettings=geekimageSettings;if(that.geekimageSettings.galleries)
delete(that.geekimageSettings.galleries['all']);this.uploader=new FileUploader({url:'/api/images'});this.uploadAll=function(){if(this.checkValidUpload())
that.uploader.uploadAll();};this.checkValidUpload=function(){var hasError=false;_.each(that.uploader.queue,function(item){item.errors={};if(that.requirecaption&&!item.caption){item.errors.caption="Caption required";hasError=true;}
if(that.requiregallery&&!item.gallery){item.errors.gallery="Gallery required";hasError=true;}});return hasError===false;};this.uploader.onBeforeUploadItem=function(fileItem){fileItem.formData.push({'license[licenseid]':that.license.licenseid});if(that.license.makedefault)
fileItem.formData.push({'license[makedefault]':true});fileItem.formData.push({'objecttype':that.objecttype});fileItem.formData.push({'objectid':that.objectid});if(fileItem.caption)
fileItem.formData.push({'caption':fileItem.caption});if(fileItem.adminnote)
fileItem.formData.push({'adminnote':fileItem.adminnote});if(fileItem.gallery)
fileItem.formData.push({'gallery':fileItem.gallery});};this.uploader.onWhenAddingFileFailed=function(item,filter,options){};this.uploader.onAfterAddingFile=function(fileItem){};this.uploader.onAfterAddingAll=function(addedFileItems){};this.uploader.onProgressItem=function(fileItem,progress){};this.uploader.onProgressAll=function(progress){};this.uploader.onSuccessItem=function(fileItem,response,status,headers){if(response.imageid)
fileItem.imageid=response.imageid;};this.uploader.onErrorItem=function(fileItem,response,status,headers){fileItem.error=response.error;};this.uploader.onCancelItem=function(fileItem,response,status,headers){};this.uploader.onCompleteItem=function(fileItem,response,status,headers){};this.uploader.onCompleteAll=function(){};}]);geekApp.directive('myEnter',function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){if(event.which===13){scope.$apply(function(){scope.$eval(attrs.myEnter);});event.preventDefault();}});};});geekApp.directive('focusMe',['$timeout','$parse',function($timeout,$parse){return{link:function(scope,element,attrs){var model=$parse(attrs.focusMe);scope.$watch(model,function(value){if(value===true){$timeout(function(){element[0].focus();});}});element.bind('blur',function(){scope.$apply(model.assign(scope,false));});}};}]);geekApp.directive('imageUploader',[function(){return{restrict:'E',scope:{objecttype:'@',objectid:'@',requirecaption:'@',requiregallery:'@',showadminnotes:'@',subtype:'@'},controller:'userImageUploaderCtrl',controllerAs:'imuctrl',templateUrl:'imageUploader.html',bindToController:true,replace:true};}]);
geekApp.directive('licenseSelector',[function(){return{restrict:'E',scope:{license:'='},controller:'LicenseSelectorCtrl',controllerAs:'licctrl',templateUrl:'licenseSelector.html',bindToController:true};}]);geekApp.factory('licenseHttpTools',['$http',function($http){var tools={};tools.getLicenses=$http.get('/api/licenses',{cache:true});tools.getDefaultUserLicenseid=$http.get('/api/licenses/userdefault');return tools;}]);geekApp.directive('geekLicense',['licenseHttpTools',function(licenseHttpTools){return{restrict:'E',link:function(scope){scope.$watch('licenseid',function(licenseid){if(!licenseid)
return;licenseHttpTools.getLicenses.then(function(response){scope.cc_attribs=response.data.cc_attribs;scope.licenseobj=_.find(response.data.licenses,{licenseid:licenseid});});});},scope:{licenseid:'='},templateUrl:'geekLicense.html'}}]);geekApp.controller('LicenseSelectorCtrl',['$scope','licenseHttpTools',function($scope,licenseHttpTools){var that=this;that.license=null;licenseHttpTools.getLicenses.then(function(response){that.cc_attribs=response.data.cc_attribs;});licenseHttpTools.getDefaultUserLicenseid.then(function(response){return response.data.licenseid;}).then(function(licenseid){getLicenseFromLicenseid(licenseid).then(function(license){that.license=angular.copy(license);});});var getLicenseFromLicenseid=function(licenseid){return licenseHttpTools.getLicenses.then(function(response){var license=_.find(response.data.licenses,{licenseid:licenseid});var alwaysCC=_(response.data.cc_attribs).filter({always:true}).map('code').value();license.cc=_.union(license.cc,alwaysCC);return license;});};this.updateCC=function(permission){if(permission=='nd'&&_.includes(that.license.cc,'nd'))
_.remove(that.license.cc,function(value){return value==='sa'});if(permission=='sa'&&_.includes(that.license.cc,'sa'))
_.remove(that.license.cc,function(value){return value==='nd'});};var getLicenseidFromLicense=function(license){return licenseHttpTools.getLicenses.then(function(response){var getLicenseid=function(licenses,license){var ccattribsMatch=function(lic){return lic.licensetype!='cc'||_.isEqual(lic.cc,license.cc.sort());};return _(licenses).filter({licensetype:license.licensetype}).find(ccattribsMatch).licenseid;};return getLicenseid(response.data.licenses,license);});};$scope.$watch(function(){return that.license;},function(license){if(!license)
return;getLicenseidFromLicense(license).then(function(licenseid){that.license.licenseid=licenseid;});},true);}]);
geekApp.directive('analyticsOn',['$window',function($window){return{restrict:'A',link:function($scope,$element,$attrs){var eventType=$attrs.analyticsOn||'click';var trackingData={};angular.forEach($attrs.$attr,function(attr,name){if(isProperty(name)){trackingData[propertyName(name)]=$attrs[name];$attrs.$observe(name,function(value){trackingData[propertyName(name)]=value;});}});angular.element($element[0]).on(eventType,function($event){var eventName=$attrs.analyticsEvent||inferEventName($element[0]);$window.ga('send',eventName,trackingData.category,trackingData.action,trackingData.label,trackingData.value);});}}}]);function isCommand(element){return['a:','button:','button:button','button:submit','input:button','input:submit'].indexOf(element.tagName.toLowerCase()+':'+(element.type||''))>=0;}
function inferEventName(element){if(isCommand(element))return element.innerText||element.value;return element.id||element.name||element.tagName;}
function isProperty(name){return name.substr(0,9)==='analytics'&&['On','Event','If','Properties','EventType'].indexOf(name.substr(9))===-1;}
function propertyName(name){var s=name.slice(9);if(typeof s!=='undefined'&&s!==null&&s.length>0){return s.substring(0,1).toLowerCase()+s.substring(1);}
else{return s;}}
angular.module('geekAwardsData',[]).constant('geekAwardsData',GEEK.geekAwardsData).constant('geekAwardCategories',GEEK.geekAwardCategories).constant('geekAwardSubdomains',GEEK.geekAwardSubdomains);app.requires.push('geekAwardsData');geekApp.directive('geekAwardsNominate',[function(){return{restrict:'A',controller:'geekAwardsNominateCtrl',controllerAs:'$ctrl',bindToController:true}}]);geekApp.directive('geekAwardsObjectinfo',[function(){return{restrict:'E',templateUrl:'geekawards_objectinfo.tpl'}}]);geekApp.directive('geekAwardsUserNominees',[function(){return{restrict:'E',templateUrl:'geekawards_usernominees.tpl'}}]);geekApp.factory('geekAwardsHttpTools',['$http','geekAPIUrls','$httpParamSerializerJQLike',function($http,geekAPIUrls,$httpParamSerializerJQLike){var httpTools={};httpTools.getNominees=function(data){var url="/api/geekawards/nominees";return $http.get(url,{params:data,paramSerializer:'$httpParamSerializerJQLike',cache:false});};httpTools.getUserNominees=function(data){var url='/api/geekawards/user/nominees';return $http.get(url,{params:data});};httpTools.saveNominee=function(data){var url='/api/geekawards/user/nominees';return $http.post(url,data);};httpTools.removeNominee=function(item){var url='/api/geekawards/user/nominees/'+item.id;return $http.delete(url);};httpTools.getItem=function(item){return $http.get(geekAPIUrls.geekitems,{params:{objecttype:item.objecttype,objectid:item.objectid},cache:true});};return httpTools;}]);geekApp.controller('geekAwardsNominateCtrl',['geekAwardsHttpTools','geekAwardsData','geekAwardCategories','geekAwardSubdomains','notify','$scope',function(geekAwardsHttpTools,geekAwardsData,geekAwardCategories,geekAwardSubdomains,notify,$scope){var that=this;this.prettycollection={'own':'Own','played':'Played','rated':'Rated','all':'All'};this.videogame_platforms=[{name:'Mobile/Handheld',value:'mobile'},{name:'PC',value:'pc'},{name:'XBox One',value:'xbox1'},{name:'PS4',value:'ps4'},{name:'Nintendo Switch',value:'switch'},{name:'WiiU',value:'wiiu'},{name:'3DS',value:'3ds'}];this.$onInit=function(){this.prettyPropertyNames=[];this.prettyPropertyNames[0]='All';this.prettyPropertyNames[1002]='Card Game';this.prettyPropertyNames[1042]='Expansions';this.prettyPropertyNames[1120]='Print & Play';this.prettyPropertyNames[2023]='Cooperative';this.prettyawardgroup={};this.selectedItemData=null;this.nominees=[];this.loadvars={loading:false,saving:false};this.data=geekAwardsData;this.data.propertyids=[];this.data.hideexpansions=0;this.getNominees(this.data);this.getUserNominees(this.data);this.domain=geekAwardsData.domain;this.categories=geekAwardCategories[this.domain][this.data.awardgroup].categories;this.awardgroups=geekAwardCategories[this.domain];this.subdomains=geekAwardSubdomains;this.prettyplatform="All";this.prettyPropertyName="All";_.each(this.awardgroups,function(awardgroup,key){that.prettyawardgroup[key]=awardgroup.name;});};this.updateHideExpansions=function(){this.getNominees(that.data);};this.updateCategories=function(){this.categories=geekAwardCategories[this.domain][this.data.awardgroup].categories;};this.saveNominee=function(category,item){var data={objecttype:item.objecttype,objectid:item.objectid,category:category.category,domain:this.domain};geekAwardsHttpTools.saveNominee(data).then(function(response){notify("Saved nominee");that.getUserNominees(that.data);},function errorHandler(response){notify(response.data.errors.error);})};this.removeNominee=function(item){geekAwardsHttpTools.removeNominee(item).then(function(response){notify("Removed nominee");that.getUserNominees(that.data);},function errorHandler(response){notify(response.data.errors.error);})};this.getNominee=function(){if(this.selectedItem){geekAwardsHttpTools.getItem(this.selectedItem).then(function(response){that.selectedItemData=response.data.item;},function errorResponse(response){});}};this.getNominees=function(data){this.loadvars.loading=true;geekAwardsHttpTools.getNominees(data).then(function(response){that.nominees=response.data;that.loadvars.loading=false;},function errorResponse(response){});};this.getUserNominees=function(data){geekAwardsHttpTools.getUserNominees(data).then(function(response){that.usernominees=response.data;},function errorResponse(response){});};this.updateAwardGroup=function(awardgroup){this.data.awardgroup=awardgroup;this.data.mode='all';this.data.subdomainids=[];this.prettysubdomain='';this.nominees=null;this.updateFilters();};this.updateFilters=function(){this.selectedItemData=null;this.updateCategories();this.getNominees(this.data);};this.updatePropertyFilters=function(value){if(value)
this.data.propertyids=[value];else
this.data.propertyids=[];this.prettyPropertyName=this.prettyPropertyNames[value];this.updateFilters();};this.updateSubdomainFilter=function(subdomain){if(subdomain){this.data.subdomainids=[subdomain.objectid];this.prettysubdomain=subdomain.name;}
else{this.prettysubdomain='All';this.data.subdomainids=[];}
this.updateFilters();};this.updatePlatformFilter=function(platform){if(platform){this.data.platform=platform.value;this.prettyplatform=platform.name;}else{this.data.platform='';this.prettyplatform='All';}
this.updateFilters();}}]);
geekApp.directive('geektv',[function(){return{restrict:'E',templateUrl:'geektv_main.tpl',bindToController:true,controller:'GeekTV_Ctrl',controllerAs:'$ctrl'}}]);geekApp.controller('GeekTV_Ctrl',['$http','$q',function($http,$q){this.data={};this.$onInit=function(){var that=this;that.loading=true;var promises=[];var promise1=$http.get('/api/geektv/channels').then(function(response){that.data.channels=response.data;},function error(response){});var promise2=$http.get('/api/geektv/channels?active=1').then(function(response){that.data.active_channel=response.data.active_channel;},function error(response){});var promise3=$http.get('/api/geektv/modulestate').then(function(response){that.data.modulestate=response.data;},function error(response){});var promise5=$http.get('/api/geektv/mode').then(function(response){that.data.mode=response.data;},function error(response){});var promise6=$http.get('/api/geektv/youtubeid').then(function(response){that.data.youtubeid=response.data;},function error(response){});promises.push(promise1);promises.push(promise2);promises.push(promise3);promises.push(promise5);promises.push(promise6);$q.all(promises).then(function(){that.loading=false;});};this.updateModuleState=function(){$http.post('/api/geektv/modulestate',{'modulestate':this.data.modulestate});};this.setActiveChannel=function(){$http.post('/api/geektv/channels/active',{'channel':this.data.active_channel});};this.setMode=function(){$http.post('/api/geektv/mode',{'mode':this.data.mode});};this.setYoutubeId=function(){$http.post('/api/geektv/youtubeid',{'youtubeid':this.data.youtubeid});};this.updateModuleTemplate=function(){$http.post('/api/geektv/moduletemplate',{'moduletemplate':this.data.moduletemplate});}}]);
geekApp.directive('geekwalmart',[function(){return{restrict:'E',templateUrl:'geekwalmart_main.tpl',bindToController:true,controller:'GeekWalmart_Ctrl',controllerAs:'$ctrl'}}]);geekApp.controller('GeekWalmart_Ctrl',['$http','$q',function($http,$q){this.data={};this.$onInit=function(){var that=this;that.loading=true;$http.get('/api/geekwalmart/catalog').then(function(response){that.data=response.data;})};this.assignItem=function(item,foundItem){var data={fieldname:'walmart_id',value:item.walmart_id};var that=this;$http.patch('/api/geekitems/'+foundItem.objecttype+'/'+foundItem.objectid,data).then(function(){that.data=that.data.filter(function(p){return(p.walmart_id!=item.walmart_id);});});}}]);
